เอาต์พุตของการสตรีมมีการตัดเหลือเพียง 5000 บรรทัดสุดท้าย
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 18:45:00+00:00 at 2023-06-08 18:46:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:45:00+00:00: New SL=1963.97914 (Old SL=1963.17883)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:46:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 18:46:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1963.99500, SL=1963.25159, TP=1965.33312
INFO:root:               [Patch B Check] TP HIT (BUY). Order 2023-06-08 18:39:00+00:00. Exit Price: 1964.11405
INFO:root:      Order Closing: Time=2023-06-08 18:47:00+00:00, Final Reason=TP, ExitPrice=1964.11405, EntryTime=2023-06-08 18:39:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-0.00 (Raw PNL=0.60, Comm=0.20, SpreadCost=0.40, Slip=-0.40)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:45:00+00:00: New SL=1964.13673 (Old SL=1963.97914)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 18:46:00+00:00 at 2023-06-08 18:47:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:46:00+00:00: New SL=1964.13673 (Old SL=1963.25159)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-08 18:45:00+00:00 at 2023-06-08 18:48:00+00:00.
INFO:root:      Moving SL to Entry (1963.94495) after PTP1 for order 2023-06-08 18:45:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-08 18:48:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1964.55784, EntryTime=2023-06-08 18:45:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-08 18:46:00+00:00 at 2023-06-08 18:48:00+00:00.
INFO:root:      Moving SL to Entry (1963.99500) after PTP1 for order 2023-06-08 18:46:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-08 18:48:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1964.58972, EntryTime=2023-06-08 18:46:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:48:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 18:48:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.34497, SL=1963.56410, TP=1965.75054
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 18:48:00+00:00 at 2023-06-08 18:49:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:48:00+00:00: New SL=1964.47496 (Old SL=1963.56410)
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:48:00+00:00: New SL=1964.48676 (Old SL=1964.47496)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 18:48:00+00:00. Exit Price: 1964.48676
INFO:root:      Order Closing: Time=2023-06-08 18:51:00+00:00, Final Reason=SL, ExitPrice=1964.48676, EntryTime=2023-06-08 18:48:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.55 (Raw PNL=-0.06, Comm=0.10, SpreadCost=0.20, Slip=-0.39)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:51:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 18:51:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.64502, SL=1963.82688, TP=1966.11767
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:55:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 18:55:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.69495, SL=1963.92436, TP=1966.08199
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 18:51:00+00:00 at 2023-06-08 18:58:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:51:00+00:00: New SL=1964.77778 (Old SL=1963.82688)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 18:55:00+00:00 at 2023-06-08 18:58:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:55:00+00:00: New SL=1964.77778 (Old SL=1963.92436)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:58:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 18:58:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.88501, SL=1964.15318, TP=1966.20230
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:51:00+00:00: New SL=1964.88256 (Old SL=1964.77778)
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:55:00+00:00: New SL=1964.88256 (Old SL=1964.77778)
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:51:00+00:00: New SL=1964.88488 (Old SL=1964.88256)
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:55:00+00:00: New SL=1964.88488 (Old SL=1964.88256)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-08 18:51:00+00:00 at 2023-06-08 19:01:00+00:00.
INFO:root:      Moving SL to Entry (1964.64502) after PTP1 for order 2023-06-08 18:51:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-08 19:01:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1965.29953, EntryTime=2023-06-08 18:51:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-08 18:55:00+00:00 at 2023-06-08 19:01:00+00:00.
INFO:root:      Moving SL to Entry (1964.69495) after PTP1 for order 2023-06-08 18:55:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-08 19:01:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1965.31141, EntryTime=2023-06-08 18:55:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 18:58:00+00:00 at 2023-06-08 19:01:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:58:00+00:00: New SL=1964.92910 (Old SL=1964.15318)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:01:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:01:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1965.14502, SL=1964.41676, TP=1966.45589
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:58:00+00:00: New SL=1964.97635 (Old SL=1964.92910)
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:58:00+00:00: New SL=1965.00412 (Old SL=1964.97635)
INFO:root:      [TSL Update] Buy Order 2023-06-08 18:58:00+00:00: New SL=1965.00597 (Old SL=1965.00412)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 18:58:00+00:00. Exit Price: 1965.00597
INFO:root:      Order Closing: Time=2023-06-08 19:05:00+00:00, Final Reason=SL, ExitPrice=1965.00597, EntryTime=2023-06-08 18:58:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.56 (Raw PNL=-0.08, Comm=0.10, SpreadCost=0.20, Slip=-0.38)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:01:00+00:00. Exit Price: 1964.41676
INFO:root:      Order Closing: Time=2023-06-08 19:05:00+00:00, Final Reason=SL, ExitPrice=1964.41676, EntryTime=2023-06-08 19:01:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.25 (Raw PNL=-0.93, Comm=0.10, SpreadCost=0.20, Slip=-0.22)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:06:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:06:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.34497, SL=1963.52532, TP=1965.82035
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:09:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:09:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.09497, SL=1963.28681, TP=1965.54966
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 19:09:00+00:00 at 2023-06-08 19:10:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:09:00+00:00: New SL=1964.23662 (Old SL=1963.28681)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:10:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:10:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.30505, SL=1963.48062, TP=1965.78903
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-08 19:09:00+00:00 at 2023-06-08 19:11:00+00:00.
INFO:root:      Moving SL to Entry (1964.09497) after PTP1 for order 2023-06-08 19:09:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-08 19:11:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1964.74150, EntryTime=2023-06-08 19:09:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 19:10:00+00:00 at 2023-06-08 19:11:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:10:00+00:00: New SL=1964.32908 (Old SL=1963.48062)
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:10:00+00:00: New SL=1964.33736 (Old SL=1964.32908)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:12:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:12:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.65503, SL=1963.82259, TP=1966.15342
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 19:06:00+00:00 at 2023-06-08 19:13:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:06:00+00:00: New SL=1964.36898 (Old SL=1963.52532)
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:10:00+00:00: New SL=1964.36898 (Old SL=1964.33736)
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:06:00+00:00: New SL=1964.40586 (Old SL=1964.36898)
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:10:00+00:00: New SL=1964.40586 (Old SL=1964.36898)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:14:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:14:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.73499, SL=1963.95835, TP=1966.13293
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:06:00+00:00: New SL=1964.45357 (Old SL=1964.40586)
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:10:00+00:00: New SL=1964.45357 (Old SL=1964.40586)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:06:00+00:00. Exit Price: 1964.45357
INFO:root:      Order Closing: Time=2023-06-08 19:16:00+00:00, Final Reason=SL, ExitPrice=1964.45357, EntryTime=2023-06-08 19:06:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.58 (Raw PNL=-0.09, Comm=0.10, SpreadCost=0.20, Slip=-0.38)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:10:00+00:00. Exit Price: 1964.45357
INFO:root:      Order Closing: Time=2023-06-08 19:16:00+00:00, Final Reason=SL, ExitPrice=1964.45357, EntryTime=2023-06-08 19:10:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.39 (Raw PNL=-0.05, Comm=0.10, SpreadCost=0.20, Slip=-0.24)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:12:00+00:00. Exit Price: 1963.82259
INFO:root:      Order Closing: Time=2023-06-08 19:18:00+00:00, Final Reason=SL, ExitPrice=1963.82259, EntryTime=2023-06-08 19:12:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.41 (Raw PNL=-1.03, Comm=0.10, SpreadCost=0.20, Slip=-0.28)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:14:00+00:00. Exit Price: 1963.95835
INFO:root:      Order Closing: Time=2023-06-08 19:18:00+00:00, Final Reason=SL, ExitPrice=1963.95835, EntryTime=2023-06-08 19:14:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.22 (Raw PNL=-0.98, Comm=0.10, SpreadCost=0.20, Slip=-0.14)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-06-08 19:18:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 4)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:20:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:20:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1963.77502, SL=1963.03637, TP=1965.10461
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 19:20:00+00:00 at 2023-06-08 19:21:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:20:00+00:00: New SL=1963.78684 (Old SL=1963.03637)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:21:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:21:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1964.01501, SL=1963.25111, TP=1965.39003
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:20:00+00:00: New SL=1963.79706 (Old SL=1963.78684)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:20:00+00:00. Exit Price: 1963.79706
INFO:root:      Order Closing: Time=2023-06-08 19:23:00+00:00, Final Reason=SL, ExitPrice=1963.79706, EntryTime=2023-06-08 19:20:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.58 (Raw PNL=-0.18, Comm=0.10, SpreadCost=0.20, Slip=-0.30)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:21:00+00:00. Exit Price: 1963.25111
INFO:root:      Order Closing: Time=2023-06-08 19:27:00+00:00, Final Reason=SL, ExitPrice=1963.25111, EntryTime=2023-06-08 19:21:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.26 (Raw PNL=-0.96, Comm=0.10, SpreadCost=0.20, Slip=-0.20)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 19:28:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-06-08 19:28:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1963.20496, SL=1962.44145, TP=1964.57927
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-08 19:28:00+00:00 at 2023-06-08 19:29:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-06-08 19:28:00+00:00: New SL=1963.25884 (Old SL=1962.44145)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-06-08 19:28:00+00:00. Exit Price: 1963.25884
INFO:root:      Order Closing: Time=2023-06-08 19:30:00+00:00, Final Reason=SL, ExitPrice=1963.25884, EntryTime=2023-06-08 19:28:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.73 (Raw PNL=-0.15, Comm=0.10, SpreadCost=0.20, Slip=-0.48)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
WARNING:root:[Patch] Kill Switch triggered due to consecutive losses.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Consecutive Losses): Fold0_BUY_NORMAL at 2023-06-08 19:30:00+00:00. Losses: 7 >= 7. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold0_BUY_NORMAL.
INFO:root:  (Closing) กำลังปิด 1 ออเดอร์ที่ยังเปิดอยู่ (Fold0_BUY_NORMAL, BUY) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '1935.375' at 2023-08-02 19:13:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-06-08 19:28:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=-28.13
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold0_BUY_NORMAL with 31 entries.
INFO:root:  (Finished) Fold0_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:31, ReEntries:0, Forced:0, BEs:0, TSLs:38
INFO:root:      Equity สุดท้าย: $60.81 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $60.81 | Max DD: 11.23% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
WARNING:root:      *** Ended run in RECOVERY MODE (Losses: 8) ***
INFO:root:   -- Running SELL Simulation Fold 1 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_SELL_NORMAL (SELL), Fold: 1, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold0_SELL_NORMAL (53512 bars)...
  Sim (Fold0_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 268, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-06-09 00:03:00+00:00...
INFO:root:      >>> Opening SELL Order (Forced) at 2023-06-09 00:03:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1965.24500, SL=1965.77512, TP=1964.13173
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 00:03:00+00:00 at 2023-06-09 00:04:00+00:00.
INFO:root:      Moving SL to Entry (1965.24500) after PTP1 for order 2023-06-09 00:03:00+00:00.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 00:03:00+00:00 at 2023-06-09 00:04:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 00:03:00+00:00: New SL=1964.76075 (Old SL=1965.24500)
INFO:root:[Patch] TP2 target set to 1964.77501 for order 2023-06-09 00:03:00+00:00
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 00:03:00+00:00. Exit Price: 1964.76075
INFO:root:      Order Closing: Time=2023-06-09 00:05:00+00:00, Final Reason=SL, ExitPrice=1964.76075, EntryTime=2023-06-09 00:03:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-0.02 (Raw PNL=0.57, Comm=0.20, SpreadCost=0.40, Slip=-0.39)
INFO:root:[Adaptive] Current Signal_Score threshold: 2.70
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 02:43:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 02:43:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1964.21497, SL=1964.85264, TP=1963.06714
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 02:43:00+00:00 at 2023-06-09 02:44:00+00:00.
INFO:root:      Moving SL to Entry (1964.21497) after PTP1 for order 2023-06-09 02:43:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 02:44:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.70482, EntryTime=2023-06-09 02:43:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 02:46:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 02:46:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1964.22498, SL=1965.07076, TP=1962.70257
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 02:46:00+00:00 at 2023-06-09 02:48:00+00:00.
INFO:root:      Moving SL to Entry (1964.22498) after PTP1 for order 2023-06-09 02:46:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 02:48:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.54835, EntryTime=2023-06-09 02:46:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 02:48:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 02:48:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.88794, SL=1964.76495, TP=1962.30932
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 02:55:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 02:55:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1964.20496, SL=1965.02000, TP=1962.73788
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 02:59:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 02:59:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1964.19495, SL=1964.95593, TP=1962.82517
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 02:48:00+00:00. Exit Price: 1964.76495
INFO:root:      Order Closing: Time=2023-06-09 03:03:00+00:00, Final Reason=SL, ExitPrice=1964.76495, EntryTime=2023-06-09 02:48:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.37 (Raw PNL=-1.08, Comm=0.10, SpreadCost=0.20, Slip=-0.19)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-06-09 02:55:00+00:00 at 2023-06-09 03:19:00+00:00.
INFO:root:      Order Closing: Time=2023-06-09 03:19:00+00:00, Final Reason=MaxBars (24), ExitPrice=1964.64502, EntryTime=2023-06-09 02:55:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.07 (Raw PNL=-0.64, Comm=0.10, SpreadCost=0.20, Slip=-0.33)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-06-09 02:59:00+00:00 at 2023-06-09 03:23:00+00:00.
INFO:root:      Order Closing: Time=2023-06-09 03:23:00+00:00, Final Reason=MaxBars (24), ExitPrice=1964.22498, EntryTime=2023-06-09 02:59:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.67 (Raw PNL=-0.23, Comm=0.10, SpreadCost=0.20, Slip=-0.34)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 03:48:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 03:48:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1964.58496, SL=1965.21355, TP=1963.45350
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 03:48:00+00:00 at 2023-06-09 03:49:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:48:00+00:00: New SL=1964.44845 (Old SL=1965.21355)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 03:49:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 03:49:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1964.27502, SL=1964.92671, TP=1963.10200
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 03:48:00+00:00 at 2023-06-09 03:50:00+00:00.
INFO:root:      Moving SL to Entry (1964.58496) after PTP1 for order 2023-06-09 03:48:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 03:50:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1964.08209, EntryTime=2023-06-09 03:48:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 03:50:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 03:50:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1964.11499, SL=1964.75613, TP=1962.96093
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 03:49:00+00:00 at 2023-06-09 03:51:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:49:00+00:00: New SL=1964.24115 (Old SL=1964.92671)
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:49:00+00:00: New SL=1964.14313 (Old SL=1964.24115)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 03:52:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 03:52:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.94495, SL=1964.57237, TP=1962.81559
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 03:49:00+00:00 at 2023-06-09 03:53:00+00:00.
INFO:root:      Moving SL to Entry (1964.27502) after PTP1 for order 2023-06-09 03:49:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 03:53:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.75368, EntryTime=2023-06-09 03:49:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 03:50:00+00:00 at 2023-06-09 03:53:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:50:00+00:00: New SL=1963.98906 (Old SL=1964.75613)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 03:53:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 03:53:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.84497, SL=1964.45758, TP=1962.74227
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 03:50:00+00:00 at 2023-06-09 03:54:00+00:00.
INFO:root:      Moving SL to Entry (1964.11499) after PTP1 for order 2023-06-09 03:50:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 03:54:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.60207, EntryTime=2023-06-09 03:50:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 03:52:00+00:00 at 2023-06-09 03:54:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:52:00+00:00: New SL=1963.87414 (Old SL=1964.57237)
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 03:52:00+00:00. Exit Price: 1963.87414
INFO:root:      Order Closing: Time=2023-06-09 03:55:00+00:00, Final Reason=SL, ExitPrice=1963.87414, EntryTime=2023-06-09 03:52:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.34 (Raw PNL=-0.13, Comm=0.10, SpreadCost=0.20, Slip=-0.11)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:06:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:06:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.93506, SL=1964.49304, TP=1962.93070
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 03:53:00+00:00 at 2023-06-09 04:10:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:53:00+00:00: New SL=1963.79494 (Old SL=1964.45758)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:06:00+00:00 at 2023-06-09 04:10:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:06:00+00:00: New SL=1963.79494 (Old SL=1964.49304)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:10:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:10:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.88794, SL=1964.37209, TP=1963.01648
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:53:00+00:00: New SL=1963.76344 (Old SL=1963.79494)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 04:06:00+00:00 at 2023-06-09 04:11:00+00:00.
INFO:root:      Moving SL to Entry (1963.93506) after PTP1 for order 2023-06-09 04:06:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 04:11:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.48868, EntryTime=2023-06-09 04:06:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 04:10:00+00:00 at 2023-06-09 04:11:00+00:00.
INFO:root:      Moving SL to Entry (1963.88794) after PTP1 for order 2023-06-09 04:10:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 04:11:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.50062, EntryTime=2023-06-09 04:10:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:11:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:11:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.58801, SL=1964.11236, TP=1962.64419
INFO:root:      [TSL Update] Sell Order 2023-06-09 03:53:00+00:00: New SL=1963.65826 (Old SL=1963.76344)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:12:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:12:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.48804, SL=1964.00213, TP=1962.56268
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 03:53:00+00:00 at 2023-06-09 04:13:00+00:00.
INFO:root:      Moving SL to Entry (1963.84497) after PTP1 for order 2023-06-09 03:53:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 04:13:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.35488, EntryTime=2023-06-09 03:53:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 04:11:00+00:00 at 2023-06-09 04:13:00+00:00.
INFO:root:      Moving SL to Entry (1963.58801) after PTP1 for order 2023-06-09 04:11:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 04:13:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1963.16854, EntryTime=2023-06-09 04:11:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:12:00+00:00 at 2023-06-09 04:13:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:12:00+00:00: New SL=1963.38609 (Old SL=1964.00213)
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:12:00+00:00. Exit Price: 1963.38609
INFO:root:      Order Closing: Time=2023-06-09 04:14:00+00:00, Final Reason=SL, ExitPrice=1963.38609, EntryTime=2023-06-09 04:12:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.61 (Raw PNL=-0.10, Comm=0.10, SpreadCost=0.20, Slip=-0.41)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:16:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:16:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.23401, SL=1963.73074, TP=1962.33990
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:16:00+00:00 at 2023-06-09 04:17:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:16:00+00:00: New SL=1963.12555 (Old SL=1963.73074)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:17:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:17:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.14502, SL=1963.64228, TP=1962.24995
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 04:16:00+00:00 at 2023-06-09 04:18:00+00:00.
INFO:root:      Moving SL to Entry (1963.23401) after PTP1 for order 2023-06-09 04:16:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 04:18:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1962.83663, EntryTime=2023-06-09 04:16:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:17:00+00:00 at 2023-06-09 04:18:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:17:00+00:00: New SL=1963.11085 (Old SL=1963.64228)
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:17:00+00:00. Exit Price: 1963.11085
INFO:root:      Order Closing: Time=2023-06-09 04:19:00+00:00, Final Reason=SL, ExitPrice=1963.11085, EntryTime=2023-06-09 04:17:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.65 (Raw PNL=-0.17, Comm=0.10, SpreadCost=0.20, Slip=-0.39)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:20:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:20:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.93506, SL=1963.48195, TP=1961.95066
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:20:00+00:00 at 2023-06-09 04:24:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:20:00+00:00: New SL=1962.90295 (Old SL=1963.48195)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:24:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:24:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.83496, SL=1963.32311, TP=1961.95629
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:20:00+00:00: New SL=1962.80548 (Old SL=1962.90295)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:24:00+00:00 at 2023-06-09 04:25:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:24:00+00:00: New SL=1962.80548 (Old SL=1963.32311)
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:20:00+00:00: New SL=1962.79238 (Old SL=1962.80548)
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:24:00+00:00: New SL=1962.79238 (Old SL=1962.80548)
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:20:00+00:00. Exit Price: 1962.79238
INFO:root:      Order Closing: Time=2023-06-09 04:27:00+00:00, Final Reason=SL, ExitPrice=1962.79238, EntryTime=2023-06-09 04:20:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.39 (Raw PNL=-0.06, Comm=0.10, SpreadCost=0.20, Slip=-0.23)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:24:00+00:00. Exit Price: 1962.79238
INFO:root:      Order Closing: Time=2023-06-09 04:27:00+00:00, Final Reason=SL, ExitPrice=1962.79238, EntryTime=2023-06-09 04:24:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.45 (Raw PNL=-0.16, Comm=0.10, SpreadCost=0.20, Slip=-0.19)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:29:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:29:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.85400, SL=1963.33790, TP=1961.98299
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:29:00+00:00 at 2023-06-09 04:30:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:29:00+00:00: New SL=1962.80201 (Old SL=1963.33790)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:30:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:30:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.75403, SL=1963.24335, TP=1961.87325
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 04:29:00+00:00 at 2023-06-09 04:31:00+00:00.
INFO:root:      Moving SL to Entry (1962.85400) after PTP1 for order 2023-06-09 04:29:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 04:31:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1962.46689, EntryTime=2023-06-09 04:29:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:30:00+00:00 at 2023-06-09 04:31:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:30:00+00:00: New SL=1962.70561 (Old SL=1963.24335)
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:30:00+00:00: New SL=1962.68998 (Old SL=1962.70561)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:32:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:32:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.63403, SL=1963.15228, TP=1961.70119
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:30:00+00:00: New SL=1962.68441 (Old SL=1962.68998)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-06-09 04:30:00+00:00 at 2023-06-09 04:34:00+00:00.
INFO:root:      Moving SL to Entry (1962.75403) after PTP1 for order 2023-06-09 04:30:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-06-09 04:34:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1962.36257, EntryTime=2023-06-09 04:30:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-06-09 04:32:00+00:00 at 2023-06-09 04:34:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-06-09 04:32:00+00:00: New SL=1962.51295 (Old SL=1963.15228)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:34:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:34:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.40796, SL=1962.92400, TP=1961.47909
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:32:00+00:00. Exit Price: 1962.51295
INFO:root:      Order Closing: Time=2023-06-09 04:35:00+00:00, Final Reason=SL, ExitPrice=1962.51295, EntryTime=2023-06-09 04:32:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.47 (Raw PNL=-0.08, Comm=0.10, SpreadCost=0.20, Slip=-0.29)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:39:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:39:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.71802, SL=1963.29599, TP=1961.67766
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:34:00+00:00. Exit Price: 1962.92400
INFO:root:      Order Closing: Time=2023-06-09 04:43:00+00:00, Final Reason=SL, ExitPrice=1962.92400, EntryTime=2023-06-09 04:34:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.05 (Raw PNL=-0.72, Comm=0.10, SpreadCost=0.20, Slip=-0.23)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:45:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:45:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.91797, SL=1963.50984, TP=1961.85261
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:50:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:50:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.04504, SL=1963.62673, TP=1961.99800
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:51:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:51:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.91504, SL=1963.49119, TP=1961.87797
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:54:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:54:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1962.94495, SL=1963.50210, TP=1961.94207
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:39:00+00:00. Exit Price: 1963.29599
INFO:root:      Order Closing: Time=2023-06-09 04:57:00+00:00, Final Reason=SL, ExitPrice=1963.29599, EntryTime=2023-06-09 04:39:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.24 (Raw PNL=-0.78, Comm=0.10, SpreadCost=0.20, Slip=-0.36)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 04:58:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 04:58:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.24500, SL=1963.78354, TP=1962.27561
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 05:01:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 05:01:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.15503, SL=1963.67716, TP=1962.21520
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:45:00+00:00. Exit Price: 1963.50984
INFO:root:      Order Closing: Time=2023-06-09 05:04:00+00:00, Final Reason=SL, ExitPrice=1963.50984, EntryTime=2023-06-09 04:45:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.37 (Raw PNL=-0.79, Comm=0.10, SpreadCost=0.20, Slip=-0.48)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:51:00+00:00. Exit Price: 1963.49119
INFO:root:      Order Closing: Time=2023-06-09 05:04:00+00:00, Final Reason=SL, ExitPrice=1963.49119, EntryTime=2023-06-09 04:51:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.09 (Raw PNL=-0.78, Comm=0.10, SpreadCost=0.20, Slip=-0.21)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:54:00+00:00. Exit Price: 1963.50210
INFO:root:      Order Closing: Time=2023-06-09 05:04:00+00:00, Final Reason=SL, ExitPrice=1963.50210, EntryTime=2023-06-09 04:54:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.16 (Raw PNL=-0.76, Comm=0.10, SpreadCost=0.20, Slip=-0.30)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-06-09 05:04:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 6)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-06-09 05:05:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-06-09 05:05:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1963.37500, SL=1963.88991, TP=1962.44816
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 04:50:00+00:00. Exit Price: 1963.62673
INFO:root:      Order Closing: Time=2023-06-09 05:08:00+00:00, Final Reason=SL, ExitPrice=1963.62673, EntryTime=2023-06-09 04:50:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.10 (Raw PNL=-0.78, Comm=0.10, SpreadCost=0.20, Slip=-0.21)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-06-09 05:01:00+00:00. Exit Price: 1963.67716
INFO:root:      Order Closing: Time=2023-06-09 05:08:00+00:00, Final Reason=SL, ExitPrice=1963.67716, EntryTime=2023-06-09 05:01:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.16 (Raw PNL=-0.72, Comm=0.10, SpreadCost=0.20, Slip=-0.34)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
WARNING:root:[Patch] Kill Switch triggered due to consecutive losses.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Consecutive Losses): Fold0_SELL_NORMAL at 2023-06-09 05:08:00+00:00. Losses: 8 >= 7. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold0_SELL_NORMAL.
INFO:root:  (Closing) กำลังปิด 4 ออเดอร์ที่ยังเปิดอยู่ (Fold0_SELL_NORMAL, SELL) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '1935.375' at 2023-08-02 19:13:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-06-09 04:50:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=27.37
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-06-09 04:58:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=27.57
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-06-09 05:01:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=27.48
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-06-09 05:05:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=27.70
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold0_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold0_SELL_NORMAL with 46 entries.
INFO:root:  (Finished) Fold0_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:46, ReEntries:0, Forced:1, BEs:0, TSLs:23
INFO:root:      Equity สุดท้าย: $194.02 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $194.02 | Max DD: 16.10% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
WARNING:root:      *** Ended run in RECOVERY MODE (Losses: 0) ***
INFO:root:   -- Calculating Metrics for Fold 1 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Buy (NORMAL)'...
INFO:root:    Processing 31 log entries for 'Fold 1 Buy (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 1 Buy (NORMAL)'.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Sell (NORMAL)'...
INFO:root:    Processing 46 log entries for 'Fold 1 Sell (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 1 Sell (NORMAL)'.
WARNING:root:=============== Fold 1/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 1 processed in: 5.08 seconds
WARNING:root:   (Summary) Equity=194.02, Winrate=6.06%, MaxDD=16.10%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $194.02 | Max DD: 16.10% | Winrate: 6.06% | Trades: 54 | KILL SWITCH: True | Recovery: True
INFO:root:
=============== Fold 2/5 ((Prep Data - Fund: NORMAL)) ===============
INFO:root:          Train period size: 107025
INFO:root:          Test period: 2023-08-02 19:14:00+00:00 to 2023-09-26 19:58:00+00:00 (Size: 53512)
INFO:root:          Starting Capital Fold 2: BUY=$60.81, SELL=$194.02 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 2 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_BUY_NORMAL (BUY), Fold: 2, Capital:$60.81, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold1_BUY_NORMAL (53512 bars)...
  Sim (Fold1_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:27:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 19:27:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.68506, SL=1935.19943, TP=1936.55919
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 19:27:00+00:00 at 2023-08-02 19:28:00+00:00.
INFO:root:      Moving SL to Entry (1935.68506) after PTP1 for order 2023-08-02 19:27:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 19:28:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.07356, EntryTime=2023-08-02 19:27:00+00:00
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:35:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 19:35:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.39502, SL=1934.86048, TP=1936.35719
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 19:35:00+00:00 at 2023-08-02 19:36:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 19:35:00+00:00: New SL=1935.50573 (Old SL=1934.86048)
INFO:root:      [TSL Update] Buy Order 2023-08-02 19:35:00+00:00: New SL=1935.51354 (Old SL=1935.50573)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 19:35:00+00:00. Exit Price: 1935.51354
INFO:root:      Order Closing: Time=2023-08-02 19:38:00+00:00, Final Reason=SL, ExitPrice=1935.51354, EntryTime=2023-08-02 19:35:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.28 (Raw PNL=-0.08, Comm=0.10, SpreadCost=0.20, Slip=-0.10)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:45:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 19:45:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.33496, SL=1934.88876, TP=1936.13813
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 19:45:00+00:00. Exit Price: 1934.88876
INFO:root:      Order Closing: Time=2023-08-02 19:54:00+00:00, Final Reason=SL, ExitPrice=1934.88876, EntryTime=2023-08-02 19:45:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.95 (Raw PNL=-0.65, Comm=0.10, SpreadCost=0.20, Slip=-0.20)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:55:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 19:55:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1934.95496, SL=1934.51287, TP=1935.75071
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 19:55:00+00:00 at 2023-08-02 19:57:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 19:55:00+00:00: New SL=1935.04918 (Old SL=1934.51287)
INFO:root:      [TSL Update] Buy Order 2023-08-02 19:55:00+00:00: New SL=1935.05210 (Old SL=1935.04918)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 19:55:00+00:00. Exit Price: 1935.05210
INFO:root:      Order Closing: Time=2023-08-02 19:59:00+00:00, Final Reason=SL, ExitPrice=1935.05210, EntryTime=2023-08-02 19:55:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.54 (Raw PNL=-0.10, Comm=0.10, SpreadCost=0.20, Slip=-0.33)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 20:01:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 20:01:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.23499, SL=1934.75835, TP=1936.09293
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 20:10:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 20:10:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.12500, SL=1934.66291, TP=1935.95676
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 20:10:00+00:00 at 2023-08-02 20:15:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 20:10:00+00:00: New SL=1935.20925 (Old SL=1934.66291)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 20:10:00+00:00. Exit Price: 1935.20925
INFO:root:      Order Closing: Time=2023-08-02 20:16:00+00:00, Final Reason=SL, ExitPrice=1935.20925, EntryTime=2023-08-02 20:10:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.54 (Raw PNL=-0.12, Comm=0.10, SpreadCost=0.20, Slip=-0.32)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-08-02 20:16:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 4)
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-08-02 20:01:00+00:00 at 2023-08-02 20:25:00+00:00.
INFO:root:      Order Closing: Time=2023-08-02 20:25:00+00:00, Final Reason=MaxBars (24), ExitPrice=1935.27502, EntryTime=2023-08-02 20:01:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.76 (Raw PNL=-0.16, Comm=0.10, SpreadCost=0.20, Slip=-0.50)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 20:47:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 20:47:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1934.54797, SL=1934.24218, TP=1935.09840
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 20:49:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 20:49:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1934.54797, SL=1934.25484, TP=1935.07562
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 20:49:00+00:00 at 2023-08-02 20:50:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 20:49:00+00:00: New SL=1934.52843 (Old SL=1934.25484)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 20:49:00+00:00. Exit Price: 1934.52843
INFO:root:      Order Closing: Time=2023-08-02 20:51:00+00:00, Final Reason=SL, ExitPrice=1934.52843, EntryTime=2023-08-02 20:49:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.55 (Raw PNL=-0.22, Comm=0.10, SpreadCost=0.20, Slip=-0.23)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 20:58:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 20:58:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1934.37500, SL=1934.04720, TP=1934.96504
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 20:47:00+00:00. Exit Price: 1934.24218
INFO:root:      Order Closing: Time=2023-08-02 20:59:00+00:00, Final Reason=SL, ExitPrice=1934.24218, EntryTime=2023-08-02 20:47:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.87 (Raw PNL=-0.51, Comm=0.10, SpreadCost=0.20, Slip=-0.26)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 20:58:00+00:00 at 2023-08-02 20:59:00+00:00.
INFO:root:      Moving SL to Entry (1934.37500) after PTP1 for order 2023-08-02 20:58:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 20:59:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1934.63724, EntryTime=2023-08-02 20:58:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Deactivating Recovery Mode.
INFO:root:      [2023-08-02 20:59:00+00:00] Risk Mode for *next* bar set to: normal (Losses: 0)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:00:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:00:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1933.60498, SL=1933.16035, TP=1934.67210
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:00:00+00:00 at 2023-08-02 22:01:00+00:00.
INFO:root:      Moving SL to Entry (1933.60498) after PTP1 for order 2023-08-02 22:00:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:01:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1933.96069, EntryTime=2023-08-02 22:00:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:01:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:01:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1934.85498, SL=1934.12411, TP=1936.60906
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:01:00+00:00 at 2023-08-02 22:02:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:01:00+00:00: New SL=1934.84958 (Old SL=1934.12411)
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:01:00+00:00: New SL=1934.86675 (Old SL=1934.84958)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 22:01:00+00:00. Exit Price: 1934.86675
INFO:root:      Order Closing: Time=2023-08-02 22:04:00+00:00, Final Reason=SL, ExitPrice=1934.86675, EntryTime=2023-08-02 22:01:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.62 (Raw PNL=-0.19, Comm=0.10, SpreadCost=0.20, Slip=-0.33)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:07:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:07:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1934.90796, SL=1934.09979, TP=1936.84755
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:07:00+00:00 at 2023-08-02 22:08:00+00:00.
INFO:root:      Moving SL to Entry (1934.90796) after PTP1 for order 2023-08-02 22:07:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:08:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1935.55449, EntryTime=2023-08-02 22:07:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:08:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:08:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.14502, SL=1934.30459, TP=1937.16205
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:08:00+00:00 at 2023-08-02 22:09:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:08:00+00:00: New SL=1935.23446 (Old SL=1934.30459)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:09:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:09:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.56494, SL=1934.68713, TP=1937.67169
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:08:00+00:00 at 2023-08-02 22:10:00+00:00.
INFO:root:      Moving SL to Entry (1935.14502) after PTP1 for order 2023-08-02 22:08:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:10:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1935.81736, EntryTime=2023-08-02 22:08:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:10:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:10:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.70496, SL=1934.86385, TP=1937.72362
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:21:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:21:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.53503, SL=1934.94738, TP=1936.59281
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:21:00+00:00 at 2023-08-02 22:22:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:21:00+00:00: New SL=1935.62021 (Old SL=1934.94738)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:22:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:22:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.73499, SL=1935.14731, TP=1936.79280
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:21:00+00:00 at 2023-08-02 22:23:00+00:00.
INFO:root:      Moving SL to Entry (1935.53503) after PTP1 for order 2023-08-02 22:21:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:23:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.00516, EntryTime=2023-08-02 22:21:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:09:00+00:00 at 2023-08-02 22:26:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:09:00+00:00: New SL=1935.70882 (Old SL=1934.68713)
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:09:00+00:00: New SL=1935.71569 (Old SL=1935.70882)
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:09:00+00:00: New SL=1935.71670 (Old SL=1935.71569)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:28:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:28:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.92505, SL=1935.31025, TP=1937.03169
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:09:00+00:00: New SL=1935.73372 (Old SL=1935.71670)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 22:09:00+00:00. Exit Price: 1935.73372
INFO:root:      Order Closing: Time=2023-08-02 22:30:00+00:00, Final Reason=SL, ExitPrice=1935.73372, EntryTime=2023-08-02 22:09:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.45 (Raw PNL=-0.03, Comm=0.10, SpreadCost=0.20, Slip=-0.32)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-08-02 22:10:00+00:00 at 2023-08-02 22:34:00+00:00.
INFO:root:      Order Closing: Time=2023-08-02 22:34:00+00:00, Final Reason=MaxBars (24), ExitPrice=1936.07495, EntryTime=2023-08-02 22:10:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.36 (Raw PNL=0.17, Comm=0.10, SpreadCost=0.20, Slip=-0.43)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:22:00+00:00 at 2023-08-02 22:34:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:22:00+00:00: New SL=1935.71653 (Old SL=1935.14731)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:34:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:34:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.62500, SL=1935.01002, TP=1936.73196
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 22:22:00+00:00. Exit Price: 1935.71653
INFO:root:      Order Closing: Time=2023-08-02 22:35:00+00:00, Final Reason=SL, ExitPrice=1935.71653, EntryTime=2023-08-02 22:22:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.73 (Raw PNL=-0.22, Comm=0.10, SpreadCost=0.20, Slip=-0.41)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:34:00+00:00 at 2023-08-02 22:35:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:34:00+00:00: New SL=1935.64757 (Old SL=1935.01002)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 22:34:00+00:00. Exit Price: 1935.64757
INFO:root:      Order Closing: Time=2023-08-02 22:36:00+00:00, Final Reason=SL, ExitPrice=1935.64757, EntryTime=2023-08-02 22:34:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.71 (Raw PNL=-0.18, Comm=0.10, SpreadCost=0.20, Slip=-0.43)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-08-02 22:36:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 4)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:43:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:43:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.82495, SL=1935.28342, TP=1936.79971
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:43:00+00:00 at 2023-08-02 22:47:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:43:00+00:00: New SL=1935.90486 (Old SL=1935.28342)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:47:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:47:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.92505, SL=1935.40219, TP=1936.86619
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 22:28:00+00:00 at 2023-08-02 22:48:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:28:00+00:00: New SL=1936.07600 (Old SL=1935.31025)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:43:00+00:00 at 2023-08-02 22:48:00+00:00.
INFO:root:      Moving SL to Entry (1935.82495) after PTP1 for order 2023-08-02 22:43:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:48:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.25818, EntryTime=2023-08-02 22:43:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:47:00+00:00 at 2023-08-02 22:48:00+00:00.
INFO:root:      Moving SL to Entry (1935.92505) after PTP1 for order 2023-08-02 22:47:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:48:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.34334, EntryTime=2023-08-02 22:47:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Deactivating Recovery Mode.
INFO:root:      [2023-08-02 22:48:00+00:00] Risk Mode for *next* bar set to: normal (Losses: 0)
INFO:root:      [TSL Update] Buy Order 2023-08-02 22:28:00+00:00: New SL=1936.08237 (Old SL=1936.07600)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:28:00+00:00 at 2023-08-02 22:50:00+00:00.
INFO:root:      Moving SL to Entry (1935.92505) after PTP1 for order 2023-08-02 22:28:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:50:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.41689, EntryTime=2023-08-02 22:28:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 22:50:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 22:50:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1936.21497, SL=1935.63136, TP=1937.26546
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 22:50:00+00:00 at 2023-08-02 22:51:00+00:00.
INFO:root:      Moving SL to Entry (1936.21497) after PTP1 for order 2023-08-02 22:50:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 22:51:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.68185, EntryTime=2023-08-02 22:50:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:02:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:02:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.57800, SL=1934.87474, TP=1936.84387
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:06:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:06:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.69800, SL=1935.05116, TP=1936.86230
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 23:02:00+00:00 at 2023-08-02 23:12:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.65662 (Old SL=1934.87474)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:12:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:12:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.64795, SL=1935.12941, TP=1936.58132
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.68295 (Old SL=1935.65662)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 23:12:00+00:00 at 2023-08-02 23:13:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.68295 (Old SL=1935.12941)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:13:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:13:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.85498, SL=1935.29809, TP=1936.85738
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.69202 (Old SL=1935.68295)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.69202 (Old SL=1935.68295)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.71009 (Old SL=1935.69202)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.71009 (Old SL=1935.69202)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.72794 (Old SL=1935.71009)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.72794 (Old SL=1935.71009)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.77849 (Old SL=1935.72794)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.77849 (Old SL=1935.72794)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.79181 (Old SL=1935.77849)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.79181 (Old SL=1935.77849)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.79775 (Old SL=1935.79181)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.79775 (Old SL=1935.79181)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:19:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:19:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.87500, SL=1935.43966, TP=1936.65861
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.81291 (Old SL=1935.79775)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.81291 (Old SL=1935.79775)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:02:00+00:00: New SL=1935.82592 (Old SL=1935.81291)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:12:00+00:00: New SL=1935.82592 (Old SL=1935.81291)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 23:02:00+00:00. Exit Price: 1935.82592
INFO:root:      Order Closing: Time=2023-08-02 23:22:00+00:00, Final Reason=SL, ExitPrice=1935.82592, EntryTime=2023-08-02 23:02:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.23 (Raw PNL=0.05, Comm=0.10, SpreadCost=0.20, Slip=-0.18)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 23:12:00+00:00. Exit Price: 1935.82592
INFO:root:      Order Closing: Time=2023-08-02 23:22:00+00:00, Final Reason=SL, ExitPrice=1935.82592, EntryTime=2023-08-02 23:12:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.52 (Raw PNL=-0.02, Comm=0.10, SpreadCost=0.20, Slip=-0.40)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.70
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:27:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:27:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.86499, SL=1935.54075, TP=1936.44862
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-08-02 23:06:00+00:00 at 2023-08-02 23:30:00+00:00.
INFO:root:      Order Closing: Time=2023-08-02 23:30:00+00:00, Final Reason=MaxBars (24), ExitPrice=1935.85498, EntryTime=2023-08-02 23:06:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.59 (Raw PNL=-0.04, Comm=0.10, SpreadCost=0.20, Slip=-0.45)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 23:27:00+00:00. Exit Price: 1935.54075
INFO:root:      Order Closing: Time=2023-08-02 23:35:00+00:00, Final Reason=SL, ExitPrice=1935.54075, EntryTime=2023-08-02 23:27:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.95 (Raw PNL=-0.52, Comm=0.10, SpreadCost=0.20, Slip=-0.32)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-08-02 23:35:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 4)
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-08-02 23:13:00+00:00 at 2023-08-02 23:37:00+00:00.
INFO:root:      Order Closing: Time=2023-08-02 23:37:00+00:00, Final Reason=MaxBars (24), ExitPrice=1935.75500, EntryTime=2023-08-02 23:13:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.54 (Raw PNL=-0.30, Comm=0.10, SpreadCost=0.20, Slip=-0.14)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-08-02 23:19:00+00:00 at 2023-08-02 23:43:00+00:00.
INFO:root:      Order Closing: Time=2023-08-02 23:43:00+00:00, Final Reason=MaxBars (24), ExitPrice=1935.65503, EntryTime=2023-08-02 23:19:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.68 (Raw PNL=-0.42, Comm=0.10, SpreadCost=0.20, Slip=-0.16)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:44:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:44:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.65503, SL=1935.32492, TP=1936.24923
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 23:44:00+00:00 at 2023-08-02 23:45:00+00:00.
INFO:root:      Moving SL to Entry (1935.65503) after PTP1 for order 2023-08-02 23:44:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 23:45:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1935.91912, EntryTime=2023-08-02 23:44:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:45:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:45:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1935.91504, SL=1935.55650, TP=1936.56040
INFO:root:[Patch] Deactivating Recovery Mode.
INFO:root:      [2023-08-02 23:45:00+00:00] Risk Mode for *next* bar set to: normal (Losses: 0)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 23:45:00+00:00 at 2023-08-02 23:46:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:45:00+00:00: New SL=1935.98204 (Old SL=1935.55650)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:46:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:46:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1936.01501, SL=1935.67010, TP=1936.63586
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:45:00+00:00: New SL=1935.98939 (Old SL=1935.98204)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 23:45:00+00:00. Exit Price: 1935.98939
INFO:root:      Order Closing: Time=2023-08-02 23:48:00+00:00, Final Reason=SL, ExitPrice=1935.98939, EntryTime=2023-08-02 23:45:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.67 (Raw PNL=-0.13, Comm=0.10, SpreadCost=0.20, Slip=-0.45)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 23:46:00+00:00 at 2023-08-02 23:49:00+00:00.
INFO:root:      Moving SL to Entry (1936.01501) after PTP1 for order 2023-08-02 23:46:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 23:49:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.29094, EntryTime=2023-08-02 23:46:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:49:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:49:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1936.11499, SL=1935.75917, TP=1936.75547
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 23:49:00+00:00 at 2023-08-02 23:50:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:49:00+00:00: New SL=1936.17712 (Old SL=1935.75917)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:50:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:50:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1936.32495, SL=1935.94655, TP=1937.00608
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 23:49:00+00:00 at 2023-08-02 23:51:00+00:00.
INFO:root:      Moving SL to Entry (1936.11499) after PTP1 for order 2023-08-02 23:49:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-08-02 23:51:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1936.39965, EntryTime=2023-08-02 23:49:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:51:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:51:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1936.38501, SL=1936.01564, TP=1937.04987
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 23:50:00+00:00 at 2023-08-02 23:52:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:50:00+00:00: New SL=1936.39261 (Old SL=1935.94655)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 23:51:00+00:00 at 2023-08-02 23:52:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:51:00+00:00: New SL=1936.39261 (Old SL=1936.01564)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 23:52:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-08-02 23:52:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1936.48499, SL=1936.12201, TP=1937.13835
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:50:00+00:00: New SL=1936.39564 (Old SL=1936.39261)
INFO:root:      [TSL Update] Buy Order 2023-08-02 23:51:00+00:00: New SL=1936.39564 (Old SL=1936.39261)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 23:50:00+00:00. Exit Price: 1936.39564
INFO:root:      Order Closing: Time=2023-08-02 23:54:00+00:00, Final Reason=SL, ExitPrice=1936.39564, EntryTime=2023-08-02 23:50:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.57 (Raw PNL=-0.13, Comm=0.10, SpreadCost=0.20, Slip=-0.34)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-08-02 23:51:00+00:00. Exit Price: 1936.39564
INFO:root:      Order Closing: Time=2023-08-02 23:54:00+00:00, Final Reason=SL, ExitPrice=1936.39564, EntryTime=2023-08-02 23:51:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.44 (Raw PNL=-0.19, Comm=0.10, SpreadCost=0.20, Slip=-0.15)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
WARNING:root:[Patch] Kill Switch triggered due to drawdown.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Max DD): Fold1_BUY_NORMAL at 2023-08-02 23:54:00+00:00. Drawdown 25.65% > 25%. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold1_BUY_NORMAL.
INFO:root:  (Closing) กำลังปิด 3 ออเดอร์ที่ยังเปิดอยู่ (Fold1_BUY_NORMAL, BUY) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '1900.4549560546875' at 2023-09-26 19:58:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-08-02 23:50:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=-36.17
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-08-02 23:51:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=-36.23
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-08-02 23:52:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=-36.33
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold1_BUY_NORMAL with 50 entries.
INFO:root:  (Finished) Fold1_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:50, ReEntries:0, Forced:0, BEs:0, TSLs:45
INFO:root:      Equity สุดท้าย: $-63.52 (จาก $60.81)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $-63.52 | Max DD: 25.65% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
INFO:root:   -- Running SELL Simulation Fold 2 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_SELL_NORMAL (SELL), Fold: 2, Capital:$194.02, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold1_SELL_NORMAL (53512 bars)...
  Sim (Fold1_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:24:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:24:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1935.73499, SL=1936.22228, TP=1934.85785
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-08-02 19:24:00+00:00. Exit Price: 1936.22228
INFO:root:      Order Closing: Time=2023-08-02 19:28:00+00:00, Final Reason=SL, ExitPrice=1936.22228, EntryTime=2023-08-02 19:24:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-5.10 (Raw PNL=-3.44, Comm=0.50, SpreadCost=1.00, Slip=-1.16)
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:28:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:28:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1936.03503, SL=1936.54596, TP=1935.11537
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 19:28:00+00:00 at 2023-08-02 19:29:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:28:00+00:00: New SL=1935.97152 (Old SL=1936.54596)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:28:00+00:00: New SL=1935.95607 (Old SL=1935.97152)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 19:28:00+00:00 at 2023-08-02 19:31:00+00:00.
INFO:root:      Moving SL to Entry (1936.03503) after PTP1 for order 2023-08-02 19:28:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:28:00+00:00: New SL=1935.90773 (Old SL=1936.03503)
INFO:root:[Patch] TP2 target set to 1935.68375 for order 2023-08-02 19:28:00+00:00
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:28:00+00:00: New SL=1935.89217 (Old SL=1935.90773)
INFO:root:               [Patch B Check] TP HIT (SELL). Order 2023-08-02 19:28:00+00:00. Exit Price: 1935.68375
INFO:root:      Order Closing: Time=2023-08-02 19:33:00+00:00, Final Reason=TP, ExitPrice=1935.68375, EntryTime=2023-08-02 19:28:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-0.48 (Raw PNL=0.30, Comm=0.20, SpreadCost=0.40, Slip=-0.58)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:34:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:34:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1935.69495, SL=1936.19738, TP=1934.79056
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 19:34:00+00:00 at 2023-08-02 19:35:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:34:00+00:00: New SL=1935.69735 (Old SL=1936.19738)
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-08-02 19:34:00+00:00. Exit Price: 1935.69735
INFO:root:      Order Closing: Time=2023-08-02 19:36:00+00:00, Final Reason=SL, ExitPrice=1935.69735, EntryTime=2023-08-02 19:34:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-3.84 (Raw PNL=-1.01, Comm=0.50, SpreadCost=1.00, Slip=-2.33)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:38:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:38:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1935.64502, SL=1936.17050, TP=1934.69916
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 19:38:00+00:00 at 2023-08-02 19:44:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:38:00+00:00: New SL=1935.54409 (Old SL=1936.17050)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 19:38:00+00:00 at 2023-08-02 19:45:00+00:00.
INFO:root:      Moving SL to Entry (1935.64502) after PTP1 for order 2023-08-02 19:38:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:38:00+00:00: New SL=1935.40700 (Old SL=1935.64502)
INFO:root:[Patch] TP2 target set to 1935.34266 for order 2023-08-02 19:38:00+00:00
INFO:root:      Early Exit triggered for order 2023-08-02 19:38:00+00:00 at 2023-08-02 19:46:00+00:00. Reason: EarlyExit_Reversal_2.0ATR (buffer)
INFO:root:      Order Closing: Time=2023-08-02 19:46:00+00:00, Final Reason=EarlyExit_Reversal_2.0ATR (buffer), ExitPrice=1935.49500, EntryTime=2023-08-02 19:38:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-1.13 (Raw PNL=-0.10, Comm=0.20, SpreadCost=0.40, Slip=-0.83)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-08-02 19:46:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 4)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:47:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:47:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 4. Lot adjusted: 0.05 -> 0.03
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.03, Entry=1935.49500, SL=1935.95173, TP=1934.67287
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 19:47:00+00:00 at 2023-08-02 19:49:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:47:00+00:00: New SL=1935.40732 (Old SL=1935.95173)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:49:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:49:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 4. Lot adjusted: 0.05 -> 0.03
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.03, Entry=1935.33496, SL=1935.79907, TP=1934.49957
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:47:00+00:00: New SL=1935.40108 (Old SL=1935.40732)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 19:47:00+00:00 at 2023-08-02 19:51:00+00:00.
INFO:root:      Moving SL to Entry (1935.49500) after PTP1 for order 2023-08-02 19:47:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:47:00+00:00: New SL=1935.30603 (Old SL=1935.49500)
INFO:root:[Patch] TP2 target set to 1935.19382 for order 2023-08-02 19:47:00+00:00
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-08-02 19:49:00+00:00 at 2023-08-02 19:51:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:49:00+00:00: New SL=1935.30603 (Old SL=1935.79907)
INFO:root:               [Patch B Check] TP HIT (SELL). Order 2023-08-02 19:47:00+00:00. Exit Price: 1935.19382
INFO:root:      Order Closing: Time=2023-08-02 19:52:00+00:00, Final Reason=TP, ExitPrice=1935.19382, EntryTime=2023-08-02 19:47:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-0.69 (Raw PNL=0.20, Comm=0.20, SpreadCost=0.40, Slip=-0.69)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:49:00+00:00: New SL=1935.30203 (Old SL=1935.30603)
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:49:00+00:00: New SL=1935.29512 (Old SL=1935.30203)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:53:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:53:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 5. Lot adjusted: 0.05 -> 0.03
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.03, Entry=1935.15503, SL=1935.61605, TP=1934.32518
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-08-02 19:49:00+00:00 at 2023-08-02 19:54:00+00:00.
INFO:root:      Moving SL to Entry (1935.33496) after PTP1 for order 2023-08-02 19:49:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-08-02 19:49:00+00:00: New SL=1935.17189 (Old SL=1935.33496)
INFO:root:[Patch] TP2 target set to 1935.05076 for order 2023-08-02 19:49:00+00:00
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:54:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-08-02 19:54:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 5. Lot adjusted: 0.05 -> 0.03
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.03, Entry=1935.05505, SL=1935.50317, TP=1934.24845
INFO:root:               [Patch B Check] TP HIT (SELL). Order 2023-08-02 19:49:00+00:00. Exit Price: 1935.05076
INFO:root:      Order Closing: Time=2023-08-02 19:55:00+00:00, Final Reason=TP, ExitPrice=1935.05076, EntryTime=2023-08-02 19:49:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-0.29 (Raw PNL=0.17, Comm=0.20, SpreadCost=0.40, Slip=-0.25)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-08-02 19:54:00+00:00. Exit Price: 1935.50317
INFO:root:      Order Closing: Time=2023-08-02 20:04:00+00:00, Final Reason=SL, ExitPrice=1935.50317, EntryTime=2023-08-02 19:54:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.03, PnL(Net USD)=-2.78 (Raw PNL=-1.62, Comm=0.25, SpreadCost=0.50, Slip=-0.91)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
WARNING:root:[Patch] Kill Switch triggered due to consecutive losses.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Consecutive Losses): Fold1_SELL_NORMAL at 2023-08-02 20:04:00+00:00. Losses: 7 >= 7. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold1_SELL_NORMAL.
INFO:root:  (Closing) กำลังปิด 2 ออเดอร์ที่ยังเปิดอยู่ (Fold1_SELL_NORMAL, SELL) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '1900.4549560546875' at 2023-09-26 19:58:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-08-02 19:53:00+00:00, Reason=End of Period, Lot=0.03, PnL(Net USD)=86.00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-08-02 19:54:00+00:00, Reason=End of Period, Lot=0.03, PnL(Net USD)=85.75
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold1_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold1_SELL_NORMAL with 13 entries.
INFO:root:  (Finished) Fold1_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:13, ReEntries:0, Forced:0, BEs:0, TSLs:14
INFO:root:      Equity สุดท้าย: $350.06 (จาก $194.02)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $350.06 | Max DD: 8.10% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
WARNING:root:      *** Ended run in RECOVERY MODE (Losses: 0) ***
INFO:root:   -- Calculating Metrics for Fold 2 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Buy (NORMAL)'...
INFO:root:    Processing 50 log entries for 'Fold 2 Buy (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 2 Buy (NORMAL)'.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Sell (NORMAL)'...
INFO:root:    Processing 13 log entries for 'Fold 2 Sell (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 2 Sell (NORMAL)'.
WARNING:root:=============== Fold 2/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 2 processed in: 3.67 seconds
WARNING:root:   (Summary) Equity=350.06, Winrate=11.11%, MaxDD=25.65%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $350.06 | Max DD: 25.65% | Winrate: 11.11% | Trades: 46 | KILL SWITCH: True | Recovery: True
INFO:root:
=============== Fold 3/5 ((Prep Data - Fund: NORMAL)) ===============
INFO:root:          Train period size: 160537
INFO:root:          Test period: 2023-09-26 19:59:00+00:00 to 2023-11-20 16:16:00+00:00 (Size: 53512)
INFO:root:          Starting Capital Fold 3: BUY=$1.00, SELL=$350.06 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 3 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_BUY_NORMAL (BUY), Fold: 3, Capital:$1.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold2_BUY_NORMAL (53512 bars)...
  Sim (Fold2_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:03:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-09-26 20:03:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1900.52502, SL=1899.96706, TP=1901.52935
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:12:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-09-26 20:12:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1900.45496, SL=1900.01108, TP=1901.25392
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:13:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-09-26 20:13:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.01, Entry=1900.54504, SL=1900.10287, TP=1901.34095
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.70
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-09-26 20:03:00+00:00 at 2023-09-26 20:27:00+00:00.
INFO:root:      Order Closing: Time=2023-09-26 20:27:00+00:00, Final Reason=MaxBars (24), ExitPrice=1900.35498, EntryTime=2023-09-26 20:03:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.77 (Raw PNL=-0.37, Comm=0.10, SpreadCost=0.20, Slip=-0.30)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
WARNING:root:[Patch] Kill Switch triggered due to drawdown.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Max DD): Fold2_BUY_NORMAL at 2023-09-26 20:27:00+00:00. Drawdown 77.44% > 25%. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold2_BUY_NORMAL.
INFO:root:  (Closing) กำลังปิด 3 ออเดอร์ที่ยังเปิดอยู่ (Fold2_BUY_NORMAL, BUY) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '1974.2249755859375' at 2023-11-20 16:16:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-09-26 20:03:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=73.40
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-09-26 20:12:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=73.47
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-09-26 20:13:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=73.38
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold2_BUY_NORMAL with 4 entries.
INFO:root:  (Finished) Fold2_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:4, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $220.48 (จาก $1.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $220.48 | Max DD: 77.44% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
INFO:root:   -- Running SELL Simulation Fold 3 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_SELL_NORMAL (SELL), Fold: 3, Capital:$350.06, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold2_SELL_NORMAL (53512 bars)...
  Sim (Fold2_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:04:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:04:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1900.67505, SL=1901.23517, TP=1899.66683
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:07:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:07:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1900.66504, SL=1901.20030, TP=1899.70158
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:08:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:08:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1900.56494, SL=1901.08596, TP=1899.62710
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:19:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:19:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1900.60498, SL=1900.94259, TP=1899.99728
INFO:root:[Adaptive] Current Signal_Score threshold: 0.70
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:19:00+00:00 at 2023-09-26 20:23:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:19:00+00:00: New SL=1900.59478 (Old SL=1900.94259)
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:23:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:23:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1900.62500, SL=1900.94109, TP=1900.05603
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:19:00+00:00: New SL=1900.59158 (Old SL=1900.59478)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:23:00+00:00 at 2023-09-26 20:24:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:23:00+00:00: New SL=1900.60159 (Old SL=1900.94109)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:19:00+00:00: New SL=1900.57967 (Old SL=1900.59158)
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:23:00+00:00: New SL=1900.57967 (Old SL=1900.60159)
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:04:00+00:00 at 2023-09-26 20:26:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:04:00+00:00: New SL=1900.53322 (Old SL=1901.23517)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:07:00+00:00 at 2023-09-26 20:26:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:07:00+00:00: New SL=1900.53322 (Old SL=1901.20030)
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:19:00+00:00: New SL=1900.53322 (Old SL=1900.57967)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-09-26 20:23:00+00:00 at 2023-09-26 20:26:00+00:00.
INFO:root:      Moving SL to Entry (1900.62500) after PTP1 for order 2023-09-26 20:23:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:23:00+00:00: New SL=1900.53322 (Old SL=1900.62500)
INFO:root:[Patch] TP2 target set to 1900.41111 for order 2023-09-26 20:23:00+00:00
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:26:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:26:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.05, Entry=1900.48499, SL=1900.81098, TP=1899.89820
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:04:00+00:00: New SL=1900.49368 (Old SL=1900.53322)
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:07:00+00:00: New SL=1900.49368 (Old SL=1900.53322)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-09-26 20:19:00+00:00 at 2023-09-26 20:27:00+00:00.
INFO:root:      Moving SL to Entry (1900.60498) after PTP1 for order 2023-09-26 20:19:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:19:00+00:00: New SL=1900.49368 (Old SL=1900.60498)
INFO:root:[Patch] TP2 target set to 1900.40251 for order 2023-09-26 20:19:00+00:00
INFO:root:               [Patch B Check] TP HIT (SELL). Order 2023-09-26 20:23:00+00:00. Exit Price: 1900.41111
INFO:root:      Order Closing: Time=2023-09-26 20:27:00+00:00, Final Reason=TP, ExitPrice=1900.41111, EntryTime=2023-09-26 20:23:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-0.86 (Raw PNL=0.03, Comm=0.20, SpreadCost=0.40, Slip=-0.69)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:      [Patch B Check] Max Holding Bars (24) reached for order 2023-09-26 20:04:00+00:00 at 2023-09-26 20:28:00+00:00.
INFO:root:      Order Closing: Time=2023-09-26 20:28:00+00:00, Final Reason=MaxBars (24), ExitPrice=1900.33496, EntryTime=2023-09-26 20:04:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-1.34 (Raw PNL=0.70, Comm=0.50, SpreadCost=1.00, Slip=-1.54)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:07:00+00:00: New SL=1900.49128 (Old SL=1900.49368)
INFO:root:               [Patch B Check] TP HIT (SELL). Order 2023-09-26 20:19:00+00:00. Exit Price: 1900.40251
INFO:root:      Order Closing: Time=2023-09-26 20:28:00+00:00, Final Reason=TP, ExitPrice=1900.40251, EntryTime=2023-09-26 20:19:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-1.02 (Raw PNL=0.00, Comm=0.20, SpreadCost=0.40, Slip=-0.82)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:07:00+00:00: New SL=1900.48011 (Old SL=1900.49128)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:07:00+00:00: New SL=1900.44494 (Old SL=1900.48011)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:08:00+00:00 at 2023-09-26 20:30:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:08:00+00:00: New SL=1900.44494 (Old SL=1901.08596)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:26:00+00:00 at 2023-09-26 20:30:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:26:00+00:00: New SL=1900.44494 (Old SL=1900.81098)
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-09-26 20:07:00+00:00. Exit Price: 1900.44494
INFO:root:      Order Closing: Time=2023-09-26 20:31:00+00:00, Final Reason=SL, ExitPrice=1900.44494, EntryTime=2023-09-26 20:07:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-1.39 (Raw PNL=0.10, Comm=0.50, SpreadCost=1.00, Slip=-0.99)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-09-26 20:08:00+00:00. Exit Price: 1900.44494
INFO:root:      Order Closing: Time=2023-09-26 20:31:00+00:00, Final Reason=SL, ExitPrice=1900.44494, EntryTime=2023-09-26 20:08:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.88 (Raw PNL=-0.40, Comm=0.50, SpreadCost=1.00, Slip=-1.98)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-09-26 20:26:00+00:00. Exit Price: 1900.44494
INFO:root:      Order Closing: Time=2023-09-26 20:31:00+00:00, Final Reason=SL, ExitPrice=1900.44494, EntryTime=2023-09-26 20:26:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.95 (Raw PNL=-0.80, Comm=0.50, SpreadCost=1.00, Slip=-1.65)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 0.70
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-09-26 20:31:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 6)
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:32:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:32:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 6. Lot adjusted: 0.05 -> 0.03
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.03, Entry=1900.41504, SL=1900.73649, TP=1899.83643
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:32:00+00:00 at 2023-09-26 20:38:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:32:00+00:00: New SL=1900.35574 (Old SL=1900.73649)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:38:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2023-09-26 20:38:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 6. Lot adjusted: 0.05 -> 0.03
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.03, Entry=1900.36499, SL=1900.67774, TP=1899.80205
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:32:00+00:00: New SL=1900.34872 (Old SL=1900.35574)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:32:00+00:00: New SL=1900.34081 (Old SL=1900.34872)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-09-26 20:38:00+00:00 at 2023-09-26 20:40:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:38:00+00:00: New SL=1900.35082 (Old SL=1900.67774)
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:32:00+00:00: New SL=1900.33454 (Old SL=1900.34081)
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:38:00+00:00: New SL=1900.33454 (Old SL=1900.35082)
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:32:00+00:00: New SL=1900.32550 (Old SL=1900.33454)
INFO:root:      [TSL Update] Sell Order 2023-09-26 20:38:00+00:00: New SL=1900.32550 (Old SL=1900.33454)
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-09-26 20:32:00+00:00. Exit Price: 1900.32550
INFO:root:      Order Closing: Time=2023-09-26 20:43:00+00:00, Final Reason=SL, ExitPrice=1900.32550, EntryTime=2023-09-26 20:32:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.03, PnL(Net USD)=-1.09 (Raw PNL=-0.28, Comm=0.25, SpreadCost=0.50, Slip=-0.56)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-09-26 20:38:00+00:00. Exit Price: 1900.32550
INFO:root:      Order Closing: Time=2023-09-26 20:43:00+00:00, Final Reason=SL, ExitPrice=1900.32550, EntryTime=2023-09-26 20:38:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.03, PnL(Net USD)=-1.88 (Raw PNL=-0.40, Comm=0.25, SpreadCost=0.50, Slip=-1.23)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
WARNING:root:[Patch] Kill Switch triggered due to consecutive losses.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Consecutive Losses): Fold2_SELL_NORMAL at 2023-09-26 20:43:00+00:00. Losses: 8 >= 7. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold2_SELL_NORMAL.
INFO:root:  (Closing) กำลังปิด 2 ออเดอร์ที่ยังเปิดอยู่ (Fold2_SELL_NORMAL, SELL) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '1974.2249755859375' at 2023-11-20 16:16:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-09-26 20:32:00+00:00, Reason=End of Period, Lot=0.03, PnL(Net USD)=-185.27
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-09-26 20:38:00+00:00, Reason=End of Period, Lot=0.03, PnL(Net USD)=-185.40
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold2_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold2_SELL_NORMAL with 12 entries.
INFO:root:  (Finished) Fold2_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:12, ReEntries:0, Forced:0, BEs:0, TSLs:25
INFO:root:      Equity สุดท้าย: $-35.78 (จาก $350.06)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $-35.78 | Max DD: 4.33% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
WARNING:root:      *** Ended run in RECOVERY MODE (Losses: 10) ***
INFO:root:   -- Calculating Metrics for Fold 3 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Buy (NORMAL)'...
INFO:root:    Processing 4 log entries for 'Fold 3 Buy (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 3 Buy (NORMAL)'.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Sell (NORMAL)'...
INFO:root:    Processing 12 log entries for 'Fold 3 Sell (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 3 Sell (NORMAL)'.
WARNING:root:=============== Fold 3/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 3 processed in: 2.71 seconds
WARNING:root:   (Summary) Equity=-35.78, Winrate=37.50%, MaxDD=77.44%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $-35.78 | Max DD: 77.44% | Winrate: 37.50% | Trades: 14 | KILL SWITCH: True | Recovery: True
INFO:root:
=============== Fold 4/5 ((Prep Data - Fund: NORMAL)) ===============
INFO:root:          Train period size: 214049
INFO:root:          Test period: 2023-11-20 16:17:00+00:00 to 2024-01-16 21:35:00+00:00 (Size: 53512)
INFO:root:          Starting Capital Fold 4: BUY=$220.48, SELL=$1.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 4 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_BUY_NORMAL (BUY), Fold: 4, Capital:$220.48, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold3_BUY_NORMAL (53512 bars)...
  Sim (Fold3_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:19:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:19:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=1973.85498, SL=1972.35409, TP=1976.55659
INFO:root:[Adaptive] Current Signal_Score threshold: 1.20
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:20:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:20:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=1974.07495, SL=1972.59525, TP=1976.73840
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-20 16:19:00+00:00 at 2023-11-20 16:22:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:19:00+00:00: New SL=1973.96618 (Old SL=1972.35409)
INFO:root:[Adaptive] Current Signal_Score threshold: 1.60
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:22:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:22:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=1974.00500, SL=1972.58943, TP=1976.55303
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:19:00+00:00: New SL=1974.11289 (Old SL=1973.96618)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-20 16:20:00+00:00 at 2023-11-20 16:23:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:20:00+00:00: New SL=1974.11289 (Old SL=1972.59525)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-20 16:22:00+00:00 at 2023-11-20 16:23:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:22:00+00:00: New SL=1974.11289 (Old SL=1972.58943)
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:19:00+00:00: New SL=1974.12555 (Old SL=1974.11289)
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:20:00+00:00: New SL=1974.12555 (Old SL=1974.11289)
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:22:00+00:00: New SL=1974.12555 (Old SL=1974.11289)
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-11-20 16:19:00+00:00. Exit Price: 1974.12555
INFO:root:      Order Closing: Time=2023-11-20 16:25:00+00:00, Final Reason=SL, ExitPrice=1974.12555, EntryTime=2023-11-20 16:19:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-1.55 (Raw PNL=0.35, Comm=0.50, SpreadCost=1.00, Slip=-1.40)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-11-20 16:20:00+00:00. Exit Price: 1974.12555
INFO:root:      Order Closing: Time=2023-11-20 16:25:00+00:00, Final Reason=SL, ExitPrice=1974.12555, EntryTime=2023-11-20 16:20:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.44 (Raw PNL=-0.75, Comm=0.50, SpreadCost=1.00, Slip=-1.20)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-11-20 16:22:00+00:00. Exit Price: 1974.12555
INFO:root:      Order Closing: Time=2023-11-20 16:25:00+00:00, Final Reason=SL, ExitPrice=1974.12555, EntryTime=2023-11-20 16:22:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.82 (Raw PNL=-0.40, Comm=0.50, SpreadCost=1.00, Slip=-1.92)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:27:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:27:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=1973.49500, SL=1972.00435, TP=1976.17815
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:28:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:28:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=1973.41504, SL=1971.96146, TP=1976.03148
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:30:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:30:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=1973.50500, SL=1972.08653, TP=1976.05827
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-20 16:28:00+00:00 at 2023-11-20 16:31:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:28:00+00:00: New SL=1973.51307 (Old SL=1971.96146)
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:31:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:31:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=1973.90503, SL=1972.50186, TP=1976.43074
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-20 16:27:00+00:00 at 2023-11-20 16:32:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:27:00+00:00: New SL=1973.62535 (Old SL=1972.00435)
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:28:00+00:00: New SL=1973.62535 (Old SL=1973.51307)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-20 16:30:00+00:00 at 2023-11-20 16:32:00+00:00.
INFO:root:      [TSL Update] Buy Order 2023-11-20 16:30:00+00:00: New SL=1973.62535 (Old SL=1972.08653)
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-11-20 16:27:00+00:00. Exit Price: 1973.62535
INFO:root:      Order Closing: Time=2023-11-20 16:33:00+00:00, Final Reason=SL, ExitPrice=1973.62535, EntryTime=2023-11-20 16:27:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.91 (Raw PNL=-0.35, Comm=0.50, SpreadCost=1.00, Slip=-2.06)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-11-20 16:28:00+00:00. Exit Price: 1973.62535
INFO:root:      Order Closing: Time=2023-11-20 16:33:00+00:00, Final Reason=SL, ExitPrice=1973.62535, EntryTime=2023-11-20 16:28:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-1.23 (Raw PNL=0.05, Comm=0.50, SpreadCost=1.00, Slip=-0.79)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-11-20 16:30:00+00:00. Exit Price: 1973.62535
INFO:root:      Order Closing: Time=2023-11-20 16:33:00+00:00, Final Reason=SL, ExitPrice=1973.62535, EntryTime=2023-11-20 16:30:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.02 (Raw PNL=-0.40, Comm=0.50, SpreadCost=1.00, Slip=-1.12)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2023-11-20 16:33:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 6)
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:34:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2023-11-20 16:34:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 6. Lot adjusted: 0.05 -> 0.03
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.03, Entry=1973.18506, SL=1971.76631, TP=1975.73880
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2023-11-20 16:31:00+00:00. Exit Price: 1972.50186
INFO:root:      Order Closing: Time=2023-11-20 16:38:00+00:00, Final Reason=SL, ExitPrice=1972.50186, EntryTime=2023-11-20 16:31:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-9.97 (Raw PNL=-8.02, Comm=0.50, SpreadCost=1.00, Slip=-1.45)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
WARNING:root:[Patch] Kill Switch triggered due to consecutive losses.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Consecutive Losses): Fold3_BUY_NORMAL at 2023-11-20 16:38:00+00:00. Losses: 7 >= 7. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold3_BUY_NORMAL.
INFO:root:  (Closing) กำลังปิด 2 ออเดอร์ที่ยังเปิดอยู่ (Fold3_BUY_NORMAL, BUY) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '2027.89794921875' at 2024-01-16 21:35:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-11-20 16:31:00+00:00, Reason=End of Period, Lot=0.05, PnL(Net USD)=268.46
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2023-11-20 16:34:00+00:00, Reason=End of Period, Lot=0.03, PnL(Net USD)=136.03
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold3_BUY_NORMAL with 9 entries.
INFO:root:  (Finished) Fold3_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:9, ReEntries:0, Forced:0, BEs:0, TSLs:11
INFO:root:      Equity สุดท้าย: $602.03 (จาก $220.48)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $602.03 | Max DD: 10.41% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
WARNING:root:      *** Ended run in RECOVERY MODE (Losses: 0) ***
INFO:root:   -- Running SELL Simulation Fold 4 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_SELL_NORMAL (SELL), Fold: 4, Capital:$1.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold3_SELL_NORMAL (53512 bars)...
  Sim (Fold3_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 1.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.70
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 916, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 08:33:00+00:00...
INFO:root:      >>> Opening SELL Order (Forced) at 2023-11-21 08:33:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1993.38501, SL=1994.80114, TP=1990.83597
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-21 08:33:00+00:00 at 2023-11-21 08:34:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-11-21 08:33:00+00:00: New SL=1993.21892 (Old SL=1994.80114)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-11-21 08:33:00+00:00 at 2023-11-21 08:35:00+00:00.
INFO:root:      Moving SL to Entry (1993.38501) after PTP1 for order 2023-11-21 08:33:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-11-21 08:35:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1992.25210, EntryTime=2023-11-21 08:33:00+00:00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 143, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 10:59:00+00:00...
INFO:root:      >>> Opening SELL Order (Forced) at 2023-11-21 10:59:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1988.84497, SL=1989.75791, TP=1987.20167
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-21 10:59:00+00:00 at 2023-11-21 11:00:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-11-21 10:59:00+00:00: New SL=1988.82657 (Old SL=1989.75791)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2023-11-21 10:59:00+00:00 at 2023-11-21 11:01:00+00:00.
INFO:root:      Moving SL to Entry (1988.84497) after PTP1 for order 2023-11-21 10:59:00+00:00.
INFO:root:      Closing remaining tiny lot (0.00) after Partial TP 1.
INFO:root:      Order Closing: Time=2023-11-21 11:01:00+00:00, Final Reason=Full Close on Partial TP 1, ExitPrice=1988.11462, EntryTime=2023-11-21 10:59:00+00:00
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 101, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 12:43:00+00:00...
INFO:root:      >>> Opening SELL Order (Forced) at 2023-11-21 12:43:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=1988.24500, SL=1989.52840, TP=1985.54985
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2023-11-21 12:43:00+00:00 at 2023-11-21 12:44:00+00:00.
INFO:root:      [TSL Update] Sell Order 2023-11-21 12:43:00+00:00: New SL=1988.07229 (Old SL=1989.52840)
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:      [TSL Update] Sell Order 2023-11-21 12:43:00+00:00: New SL=1988.00957 (Old SL=1988.07229)
INFO:root:      [TSL Update] Sell Order 2023-11-21 12:43:00+00:00: New SL=1987.99661 (Old SL=1988.00957)
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2023-11-21 12:43:00+00:00. Exit Price: 1987.99661
INFO:root:      Order Closing: Time=2023-11-21 12:47:00+00:00, Final Reason=SL, ExitPrice=1987.99661, EntryTime=2023-11-21 12:43:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-0.39 (Raw PNL=0.05, Comm=0.10, SpreadCost=0.20, Slip=-0.34)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
WARNING:root:[Patch] Kill Switch triggered due to drawdown.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Max DD): Fold3_SELL_NORMAL at 2023-11-21 12:47:00+00:00. Drawdown 27.03% > 25%. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold3_SELL_NORMAL.
INFO:root:  (Closing) กำลังปิด 1 ออเดอร์ที่ยังเปิดอยู่ (Fold3_SELL_NORMAL, SELL) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '2027.89794921875' at 2024-01-16 21:35:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2023-11-21 12:43:00+00:00, Reason=End of Period, Lot=0.01, PnL(Net USD)=-39.95
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold3_SELL_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold3_SELL_NORMAL with 6 entries.
INFO:root:  (Finished) Fold3_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:6, ReEntries:0, Forced:3, BEs:0, TSLs:5
INFO:root:      Equity สุดท้าย: $-38.90 (จาก $1.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $-38.90 | Max DD: 27.03% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
INFO:root:   -- Calculating Metrics for Fold 4 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Buy (NORMAL)'...
INFO:root:    Processing 9 log entries for 'Fold 4 Buy (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 4 Buy (NORMAL)'.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Sell (NORMAL)'...
INFO:root:    Processing 6 log entries for 'Fold 4 Sell (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 4 Sell (NORMAL)'.
WARNING:root:=============== Fold 4/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 4 processed in: 6.96 seconds
WARNING:root:   (Summary) Equity=-38.90, Winrate=11.11%, MaxDD=27.03%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $-38.90 | Max DD: 27.03% | Winrate: 11.11% | Trades: 13 | KILL SWITCH: True | Recovery: True
INFO:root:
=============== Fold 5/5 ((Prep Data - Fund: NORMAL)) ===============
INFO:root:          Train period size: 267561
INFO:root:          Test period: 2024-01-16 21:36:00+00:00 to 2024-03-11 18:21:00+00:00 (Size: 53512)
INFO:root:          Starting Capital Fold 5: BUY=$602.03, SELL=$1.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 5 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_BUY_NORMAL (BUY), Fold: 5, Capital:$602.03, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold4_BUY_NORMAL (53512 bars)...
  Sim (Fold4_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:44:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 21:44:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.10, Entry=2027.66797, SL=2027.15535, TP=2028.59069
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2024-01-16 21:44:00+00:00 at 2024-01-16 21:45:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 21:44:00+00:00: New SL=2027.77992 (Old SL=2027.15535)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2024-01-16 21:44:00+00:00. Exit Price: 2027.77992
INFO:root:      Order Closing: Time=2024-01-16 21:46:00+00:00, Final Reason=SL, ExitPrice=2027.77992, EntryTime=2024-01-16 21:44:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.10, PnL(Net USD)=-6.03 (Raw PNL=-0.88, Comm=1.00, SpreadCost=2.00, Slip=-4.15)
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:50:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 21:50:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.10, Entry=2027.56494, SL=2026.99443, TP=2028.59186
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2024-01-16 21:50:00+00:00 at 2024-01-16 21:51:00+00:00.
INFO:root:      Moving SL to Entry (2027.56494) after PTP1 for order 2024-01-16 21:50:00+00:00.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2024-01-16 21:50:00+00:00 at 2024-01-16 21:51:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 21:50:00+00:00: New SL=2027.78610 (Old SL=2027.56494)
INFO:root:[Patch] TP2 target set to 2027.96327 for order 2024-01-16 21:50:00+00:00
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:               [Patch B Check] TP HIT (BUY). Order 2024-01-16 21:50:00+00:00. Exit Price: 2027.96327
INFO:root:      Order Closing: Time=2024-01-16 21:52:00+00:00, Final Reason=TP, ExitPrice=2027.96327, EntryTime=2024-01-16 21:50:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-0.15 (Raw PNL=0.99, Comm=0.50, SpreadCost=1.00, Slip=-0.64)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:52:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 21:52:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.10, Entry=2028.10803, SL=2027.48841, TP=2029.22334
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:55:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 21:55:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.10, Entry=2028.14502, SL=2027.53890, TP=2029.23604
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2024-01-16 21:52:00+00:00 at 2024-01-16 21:58:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 21:52:00+00:00: New SL=2028.12008 (Old SL=2027.48841)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2024-01-16 21:52:00+00:00. Exit Price: 2028.12008
INFO:root:      Order Closing: Time=2024-01-16 21:59:00+00:00, Final Reason=SL, ExitPrice=2028.12008, EntryTime=2024-01-16 21:52:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.10, PnL(Net USD)=-4.47 (Raw PNL=-1.88, Comm=1.00, SpreadCost=2.00, Slip=-1.59)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2024-01-16 21:55:00+00:00. Exit Price: 2027.53890
INFO:root:      Order Closing: Time=2024-01-16 23:00:00+00:00, Final Reason=SL, ExitPrice=2027.53890, EntryTime=2024-01-16 21:55:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.10, PnL(Net USD)=-11.58 (Raw PNL=-8.06, Comm=1.00, SpreadCost=2.00, Slip=-2.52)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 23:00:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 23:00:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 4. Lot adjusted: 0.10 -> 0.05
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=2026.89795, SL=2026.28756, TP=2028.17976
INFO:root:[Patch] Activating Recovery Mode due to consecutive losses.
INFO:root:      [2024-01-16 23:00:00+00:00] Risk Mode for *next* bar set to: recovery (Losses: 4)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2024-01-16 23:00:00+00:00 at 2024-01-16 23:01:00+00:00.
INFO:root:      Moving SL to Entry (2026.89795) after PTP1 for order 2024-01-16 23:00:00+00:00.
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2024-01-16 23:00:00+00:00 at 2024-01-16 23:01:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:00:00+00:00: New SL=2027.52377 (Old SL=2026.89795)
INFO:root:[Patch] TP2 target set to 2027.56193 for order 2024-01-16 23:00:00+00:00
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2024-01-16 23:00:00+00:00. Exit Price: 2027.52377
INFO:root:      Order Closing: Time=2024-01-16 23:02:00+00:00, Final Reason=SL, ExitPrice=2027.52377, EntryTime=2024-01-16 23:00:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.02, PnL(Net USD)=-0.24 (Raw PNL=0.85, Comm=0.20, SpreadCost=0.40, Slip=-0.89)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 23:10:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 23:10:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 5. Lot adjusted: 0.10 -> 0.05
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=2027.22803, SL=2026.42713, TP=2028.90992
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2024-01-16 23:10:00+00:00 at 2024-01-16 23:11:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:10:00+00:00: New SL=2027.26257 (Old SL=2026.42713)
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:10:00+00:00: New SL=2027.27345 (Old SL=2027.26257)
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:10:00+00:00: New SL=2027.27498 (Old SL=2027.27345)
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:10:00+00:00: New SL=2027.30105 (Old SL=2027.27498)
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2024-01-16 23:10:00+00:00. Exit Price: 2027.30105
INFO:root:      Order Closing: Time=2024-01-16 23:15:00+00:00, Final Reason=SL, ExitPrice=2027.30105, EntryTime=2024-01-16 23:10:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.12 (Raw PNL=-0.63, Comm=0.50, SpreadCost=1.00, Slip=-0.98)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:[Adaptive] Current Signal_Score threshold: 0.70
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 23:19:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 23:19:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 6. Lot adjusted: 0.10 -> 0.05
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=2025.94800, SL=2024.98526, TP=2027.96975
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2024-01-16 23:19:00+00:00 at 2024-01-16 23:21:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:19:00+00:00: New SL=2025.97912 (Old SL=2024.98526)
INFO:root:[Adaptive] Current Signal_Score threshold: 0.80
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 23:21:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 23:21:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 6. Lot adjusted: 0.10 -> 0.05
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=2026.08801, SL=2025.13863, TP=2028.08171
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:19:00+00:00: New SL=2026.18018 (Old SL=2025.97912)
INFO:root:         [Patch TSL] Trailing Stop Loss (TSL) ACTIVATED for order 2024-01-16 23:21:00+00:00 at 2024-01-16 23:22:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:21:00+00:00: New SL=2026.18018 (Old SL=2025.13863)
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:19:00+00:00: New SL=2026.18263 (Old SL=2026.18018)
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:21:00+00:00: New SL=2026.18263 (Old SL=2026.18018)
INFO:root:      Partial TP Level 1 (0.8R) hit for order 2024-01-16 23:19:00+00:00 at 2024-01-16 23:24:00+00:00.
INFO:root:      Moving SL to Entry (2025.94800) after PTP1 for order 2024-01-16 23:19:00+00:00.
INFO:root:      [TSL Update] Buy Order 2024-01-16 23:19:00+00:00: New SL=2026.21966 (Old SL=2025.94800)
INFO:root:[Patch] TP2 target set to 2026.73953 for order 2024-01-16 23:19:00+00:00
INFO:root:               [Patch B Check] SL HIT (BUY). Order 2024-01-16 23:21:00+00:00. Exit Price: 2026.18263
INFO:root:      Order Closing: Time=2024-01-16 23:24:00+00:00, Final Reason=SL, ExitPrice=2026.18263, EntryTime=2024-01-16 23:21:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.05, PnL(Net USD)=-2.82 (Raw PNL=-0.53, Comm=0.50, SpreadCost=1.00, Slip=-1.79)
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 23:24:00+00:00...
INFO:root:      >>> Opening BUY Order (Standard) at 2024-01-16 23:24:00+00:00 <<<
INFO:root:      (Recovery Mode Active) Losses: 7. Lot adjusted: 0.10 -> 0.05
INFO:root:         +++ ORDER OPENED: Side=BUY, Lot=0.05, Entry=2026.48499, SL=2025.50997, TP=2028.53252
WARNING:root:[Patch] Kill Switch triggered due to consecutive losses.
CRITICAL:root:     (CRITICAL) KILL SWITCH ACTIVATED (Consecutive Losses): Fold4_BUY_NORMAL at 2024-01-16 23:24:00+00:00. Losses: 7 >= 7. Stopping simulation loop.
INFO:root:Simulation loop finished for Fold4_BUY_NORMAL.
INFO:root:  (Closing) กำลังปิด 2 ออเดอร์ที่ยังเปิดอยู่ (Fold4_BUY_NORMAL, BUY) ณ สิ้นสุดช่วงเวลา...
INFO:root:      [Patch EoP] End of Period Close: Using Close price '2178.304931640625' at 2024-03-11 18:21:00+00:00
INFO:root:      [Patch EoP] End of Period Close: Order=2024-01-16 23:19:00+00:00, Reason=End of Period, Lot=0.02, PnL(Net USD)=304.11
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:      [Patch EoP] End of Period Close: Order=2024-01-16 23:21:00+00:00, Reason=End of Period, Lot=0.05, PnL(Net USD)=759.58
WARNING:root:   [Patch 26.10] safe_set_datetime: Force conversion of column 'Order_Closed_Time_Fold4_BUY_NORMAL' to datetime64[ns] failed (Cannot use .astype to convert from timezone-aware dtype to timezone-naive dtype. Use obj.tz_localize(None) or obj.tz_convert('UTC').tz_localize(None) instead.). Re-creating column with NaT.
INFO:root:Created trade log DataFrame for Fold4_BUY_NORMAL with 12 entries.
INFO:root:  (Finished) Fold4_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:12, ReEntries:0, Forced:0, BEs:0, TSLs:14
INFO:root:      Equity สุดท้าย: $1638.77 (จาก $602.03)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $1638.77 | Max DD: 4.48% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
WARNING:root:      *** Ended run in RECOVERY MODE (Losses: 0) ***
INFO:root:   -- Running SELL Simulation Fold 5 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_SELL_NORMAL (SELL), Fold: 5, Capital:$1.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:NoSwitcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: Inactive
INFO:root:Starting simulation loop for Fold4_SELL_NORMAL (53512 bars)...
  Sim (Fold4_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2024-01-16 21:41:00+00:00...
INFO:root:      >>> Opening SELL Order (Standard) at 2024-01-16 21:41:00+00:00 <<<
INFO:root:         +++ ORDER OPENED: Side=SELL, Lot=0.01, Entry=2027.61804, SL=2028.05927, TP=2026.82383
INFO:root:               [Patch B Check] SL HIT (SELL). Order 2024-01-16 21:41:00+00:00. Exit Price: 2028.05927
INFO:root:      Order Closing: Time=2024-01-16 21:45:00+00:00, Final Reason=SL, ExitPrice=2028.05927, EntryTime=2024-01-16 21:41:00+00:00
INFO:root:         [Patch PnL Final] Closed Lot=0.01, PnL(Net USD)=-1.05 (Raw PNL=-0.64, Comm=0.10, SpreadCost=0.20, Slip=-0.30)
WARNING:root:[Patch] Margin Call triggered. Equity = -0.05.
WARNING:root:      Force closing 1 orders due to Margin Call at 2024-01-16 21:45:00+00:00.
INFO:root:      Marking remaining 53502 bars with 0 equity due to Margin Call.
INFO:root:Simulation loop finished for Fold4_SELL_NORMAL.
INFO:root:Created trade log DataFrame for Fold4_SELL_NORMAL with 2 entries.
INFO:root:  (Finished) Fold4_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:2, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $0.00 (จาก $1.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $0.00 | Max DD: 0.00% | KILL SWITCH: True
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
WARNING:root:      *** KILL SWITCH ACTIVATED during this run! ***
INFO:root:   -- Calculating Metrics for Fold 5 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Buy (NORMAL)'...
INFO:root:    Processing 12 log entries for 'Fold 5 Buy (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 5 Buy (NORMAL)'.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Sell (NORMAL)'...
INFO:root:    Processing 2 log entries for 'Fold 5 Sell (NORMAL)'...
WARNING:root:    (Warning) Cannot calculate ratios for 'Fold 5 Sell (NORMAL)': No daily returns or zero initial capital.
INFO:root:  (Metrics) Finished calculating metrics for: 'Fold 5 Sell (NORMAL)'.
WARNING:root:=============== Fold 5/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 5 processed in: 2.49 seconds
WARNING:root:   (Summary) Equity=0.00, Winrate=11.11%, MaxDD=4.48%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $0.00 | Max DD: 4.48% | Winrate: 11.11% | Trades: 11 | KILL SWITCH: True | Recovery: True
INFO:root:      [Runner (Prep Data - Fund: NORMAL)] (Success) Full WF Sim completed (L1_Th=0.50) in 21.76 seconds.
INFO:root:      [Runner (Prep Data - Fund: NORMAL)] (Processing) Aggregating overall results (L1_Th=0.50)...
INFO:root:      Combined Trade Log Shape: (185, 44)
INFO:root:      [Runner (Prep Data - Fund: NORMAL)] (Calculating) Calculating overall metrics (L1_Th=0.50)...
INFO:root:  (Metrics) Calculating metrics for: 'Overall WF Buy (NORMAL)'...
INFO:root:    Processing 106 log entries for 'Overall WF Buy (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Overall WF Buy (NORMAL)'.
INFO:root:  (Metrics) Calculating metrics for: 'Overall WF Sell (NORMAL)'...
INFO:root:    Processing 79 log entries for 'Overall WF Sell (NORMAL)'...
INFO:root:  (Metrics) Finished calculating metrics for: 'Overall WF Sell (NORMAL)'.
INFO:root:      Combining fold result DataFrames...
INFO:root:      [Runner (Prep Data - Fund: NORMAL)] (Success) Combined Final M1 Results DF. Shape: (267560, 415)
INFO:root:      [Runner (Prep Data - Fund: NORMAL)] Returning aggregated results.
INFO:root:   Saving final M1 data to: ./output_default/final_data_m1_v32_walkforward_prep_data_NORMAL.csv.gz
INFO:root:   (Success) Saved final M1 data: final_data_m1_v32_walkforward_prep_data_NORMAL.csv.gz
INFO:root:   Saving generated trade log to: ./output_default/trade_log_v32_walkforward_prep_data_NORMAL.csv.gz
INFO:root:   (Success) Saved generated trade log (185 rows): trade_log_v32_walkforward_prep_data_NORMAL.csv.gz
INFO:root:(Finished) PREPARE_TRAIN_DATA ran backtest and saved results -> suffix=_prep_data_NORMAL
INFO:root:   พบไฟล์ที่จำเป็น: Log='trade_log_v32_walkforward_prep_data_NORMAL.csv.gz', M1='final_data_m1_v32_walkforward_prep_data_NORMAL.csv.gz'
INFO:root:      (safe_load) Attempting to load: trade_log_v32_walkforward_prep_data_NORMAL.csv.gz
INFO:root:
(Training - v5.4.7) เริ่มต้นการ Train Meta Classifier (Purpose: MAIN)...
INFO:root:   Model Type: catboost
INFO:root:   Sample Size Limit: 60000
INFO:root:   Features to Drop Before Final Train: None
INFO:root:   Dynamic Feature Selection: เปิดใช้งาน
INFO:root:     Method: SHAP
INFO:root:     SHAP Threshold: 0.0100
INFO:root:     Permutation Threshold: 0.0010
INFO:root:   Optuna Tuning: เปิดใช้งาน
INFO:root:   Drift Observer Provided: No
INFO:root:   Early Stopping Rounds: 200
INFO:root:   GPU Acceleration Available: False. Setting CatBoost task_type to: 'CPU' (for applicable steps).
INFO:root:   ใช้ Trade Log ที่ Filter แล้ว (Override) จำนวน 185 แถว สำหรับ Model Purpose: MAIN
INFO:root:   กำลังประมวลผล Trade Log สำหรับ Training...
INFO:root:   Target (is_tp from Log) Distribution:
is_tp
0    0.962
1    0.038
INFO:root:   ประมวลผล Trade Log สำเร็จ (185 trades).
INFO:root:   กำลังโหลด M1 Data: ./output_default/final_data_m1_v32_walkforward_prep_data_NORMAL.csv.gz
INFO:root:      (safe_load) Attempting to load: final_data_m1_v32_walkforward_prep_data_NORMAL.csv.gz
INFO:root:   โหลดและเตรียม M1 สำเร็จ (321073 แถว). จำนวน Features เริ่มต้น: 46
INFO:root:   กำลังเตรียมข้อมูลสำหรับ Meta Model Training (Purpose: MAIN)...
INFO:root:   กำลังรวม Trade Log กับ M1 Features (merge_asof)...
INFO:root:[Patch] เริ่ม Merge Trade Log กับ M1 Features (merge_asof)
INFO:root:   Merge completed. Shape after merge: (185, 90)
INFO:root:[Patch] Available Features หลัง Merge: 36 รายการ
INFO:root:[Patch] Missing Features หลัง Merge: 1 รายการ: ['Signal_Score']
INFO:root:   Features เริ่มต้นสำหรับการเลือก (36): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Long', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'cluster', 'spike_score']
INFO:root:   [NaN Check] ก่อน Drop NaN ใน Merged Data (Features/Target): 185 แถว
INFO:root:   (Success) การรวมข้อมูลเสร็จสมบูรณ์ (185 samples before sampling).
INFO:root:   (Info) Sample size (60000) >= data size (185). Using all data.
INFO:root:
   --- [Phase 2/B] กำลังดำเนินการ Dynamic Feature Selection ---
INFO:root:      (Info) ไม่พบ Categorical Feature 'Pattern_Label' สำหรับ Prelim Model.
INFO:root:      [NaN Check] ตรวจสอบ NaN/Inf ในข้อมูล Feature Selection (X_select)...
INFO:root:         เติม NaN/Inf ใน X_select สำเร็จ.
INFO:root:      กำลัง Train Preliminary Model (สำหรับ Feature Importance)...
INFO:root:         (ใช้ Default Prelim Params)
INFO:root:         (Prelim Task Type: CPU)
INFO:root:[Before Prelim Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.0% (1890MB / 12977MB)
INFO:root:[After Prelim Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.0% (1889MB / 12977MB)
INFO:root:      (Success) Train Preliminary Model สำเร็จ.
INFO:root:      กำลังคำนวณ SHAP Importance...
INFO:root:   [SHAP Select] กำลังเลือก Features ที่มี Normalized SHAP >= 0.0100...
INFO:root:      (Success) เลือก Features ได้ 34 ตัวจาก SHAP.
INFO:root:         Features ที่ถูกตัดออก 2 ตัว: ['Candle_Speed_lag3', 'Gain_Z_lag5']
INFO:root:         Features ที่เลือก (เรียงตามค่า SHAP):
INFO:root:
           Feature  Normalized_SHAP
               RSI          0.08848
       Gain_Z_lag1          0.08296
            Gain_Z          0.05282
             Close          0.04614
    ATR_14_Shifted          0.04360
 Candle_Speed_lag1          0.04167
               ADX          0.03704
              Open          0.03436
        Entry_Long          0.03382
      Candle_Range          0.03374
              Gain          0.03342
        Upper_Wick          0.03065
       spike_score          0.02923
               Low          0.02660
              High          0.02557
       Candle_Body          0.02471
         MACD_line          0.02392
      Candle_Speed          0.02383
  MACD_hist_smooth          0.02229
            ATR_14          0.02048
 Candle_Speed_lag5          0.02024
        Wick_Ratio          0.01971
        Lower_Wick          0.01941
              Date          0.01905
           cluster          0.01792
  Volatility_Index          0.01755
       Wick_Length          0.01745
ATR_14_Rolling_Avg          0.01553
       Entry_Short          0.01516
            Volume          0.01464
         MACD_hist          0.01408
       MACD_signal          0.01352
      Candle_Ratio          0.01293
       Gain_Z_lag3          0.01201
INFO:root:      Features ที่เลือกโดย SHAP (34): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Long', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'cluster', 'spike_score']
INFO:root:      พิจารณาเพิ่ม Lag Features ที่สำคัญ...
INFO:root:         Lag Features ที่มีให้พิจารณา: ['Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5']
WARNING:root:Cannot evaluate Lag Features: catboost/libs/data/model_dataset_compatibility.cpp:72: Feature Candle_Body is present in model but not in pool.
INFO:root:   --- [Phase 2/B] Final Selected Features (34): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Long', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'cluster', 'spike_score'] ---
INFO:root:
   กำลังเตรียมข้อมูล Training สุดท้ายด้วย Features ที่เลือก (34 ตัว)...
INFO:root:      [NaN Check] ตรวจสอบ NaN/Inf ในข้อมูล Final Training (X)...
INFO:root:         เติม NaN/Inf ใน X (Final) สำเร็จ.
INFO:root:      [RAM Opt] Converting Final Training Features (X) to float32 (Before Split)...
INFO:root:      (Success) แปลง 30 Final Training Features เป็น float32 (เท่าที่ทำได้) สำเร็จ.
INFO:root:
   --- [Phase 3/A] กำลังดำเนินการ Hyperparameter Optimization (Optuna) ---
WARNING:root:      (Info) Optuna logic is defined but currently disabled by ENABLE_OPTUNA_TUNING=False.
INFO:root:
   --- Training Final CatBoost Model (Purpose: MAIN) ---
INFO:root:      (Info) ไม่พบ 'Pattern_Label' ใน Features ที่เลือกสุดท้าย.
INFO:root:      Splitting data into Train/Validation sets (80/20 stratified)...
INFO:root:      Train Size (Final): 148, Validation Size (Final): 37
INFO:root:      Validation Target Distribution (Final):
is_tp
0    0.973
1    0.027
INFO:root:      [RAM Opt] Converting Train/Validation sets to float32 (After Split)...
INFO:root:      กำลังกำหนด Final Model Parameters...
INFO:root:         Using Fixed Params (v4.7.1)...
INFO:root:         Final Params: {'iterations': 3000, 'learning_rate': 0.01, 'depth': 4, 'l2_leaf_reg': 30, 'eval_metric': 'AUC', 'auto_class_weights': 'Balanced', 'early_stopping_rounds': 200, 'random_seed': 42, 'verbose': 100, 'loss_function': 'Logloss', 'task_type': 'CPU'}
INFO:root:      Fitting Final CatBoost model (Purpose: MAIN)...
INFO:root:[Before Final Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.0% (1892MB / 12977MB)
0:	test: 0.8194444	best: 0.8194444 (0)	total: 2.01ms	remaining: 6.04s
100:	test: 0.9166667	best: 0.9166667 (12)	total: 149ms	remaining: 4.28s
200:	test: 0.9166667	best: 0.9166667 (12)	total: 283ms	remaining: 3.94s
Stopped by overfitting detector  (200 iterations wait)

bestTest = 0.9166666667
bestIteration = 12

Shrink model to first 13 iterations.
INFO:root:[After Final Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.0% (1892MB / 12977MB)
INFO:root:      (Success) Final CatBoost training (Purpose: MAIN) finished in 0.34 seconds.
INFO:root:
      --- Model Quality Check (Final CatBoost Model) ---
INFO:root:   [Check] Checking for Overfitting (AUC)...
INFO:root:      Val AUC:   0.9167
INFO:root:   [Check] Checking for Overfitting (LogLoss)...
INFO:root:      Val LogLoss:   0.6638
INFO:root:      Validation Metrics (Final Model - Purpose: MAIN):
INFO:root:         Accuracy:  0.8649
INFO:root:         AUC:       0.9167
INFO:root:         LogLoss:   0.6638
INFO:root:         Classification Report:
              precision    recall  f1-score   support

      Not TP       1.00      0.86      0.93        36
          TP       0.17      1.00      0.29         1

    accuracy                           0.86        37
   macro avg       0.58      0.93      0.61        37
weighted avg       0.98      0.86      0.91        37

INFO:root:
      --- SHAP Analysis (Final Model - Validation Set - Purpose: MAIN) ---
INFO:root:
(Analyzing) SHAP analysis (CatBoostClassifier - Sample Size: 37) -  Validation Set...
INFO:root:      Calculating SHAP values (CatBoost)...
INFO:root:      Creating SHAP Summary Plot (bar type)...
INFO:root:      (Success) Saved SHAP Plot (Bar): shap_summary_CatBoostClassifier_bar_validation_set.png
INFO:root:      Creating SHAP Summary Plot (beeswarm/dot type)...
INFO:root:      (Success) Saved SHAP Plot (Beeswarm): shap_summary_CatBoostClassifier_beeswarm_validation_set.png
INFO:root:
         --- Feature Noise Check (SHAP - Final Model - Validation Set) ---
INFO:root:            Recalculating SHAP values for Noise Check (Validation Set)...
INFO:root:   [Check] Checking for Feature Noise (SHAP)...
INFO:root:[Patch] SHAP Noise features detected: ['ATR_14', 'Candle_Body', 'Candle_Speed', 'Candle_Speed_lag5', 'Entry_Long', 'Low', 'Lower_Wick', 'MACD_line', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'spike_score']
INFO:root:
   --- Saving Final Model (Purpose: MAIN) ---
INFO:root:      (Success) Saved Final CATBOOST (Purpose: MAIN): ./output_default/meta_classifier.pkl
INFO:root:   (Info) Main model saved as default (meta_classifier.pkl). No separate linking needed.
INFO:root:   Saving final selected features (34) for 'main' to: ./output_default/features_main.json
INFO:root:   (Success) Saved final features list for 'main'.
INFO:root:(Finished - v5.4.7) Meta Classifier Training (Purpose: MAIN) complete in 11.29 seconds.
INFO:root:   (Success) Train Model L1 (Main) สำเร็จ. Final Features saved to features_main.json
INFO:root:(Info) ข้ามการโหลดและเตรียมข้อมูล (Mode: TRAIN_MODEL_ONLY)
INFO:root:
(Info) ข้าม Auto Threshold Tuning (ใช้ Fixed Params สำหรับ Model).
INFO:root:
(Info) ข้าม Final Walk-Forward Run (Mode: TRAIN_MODEL_ONLY).
INFO:root:Attempting to shut down pynvml...
INFO:root:(Success) ปิดการทำงาน pynvml สำเร็จ.
INFO:root:
--- ฟังก์ชัน Main (Mode: TRAIN_MODEL_ONLY) เสร็จสิ้นใน 89.29 วินาที ---
INFO:root:
(Starting) กำลังเริ่มฟังก์ชัน Main (Mode: FULL_RUN)...
INFO:root:   (Info) Output directory already set: ./output_default
INFO:root:   (Setup) กำลังตรวจสอบ/สร้าง Output Directory: ./output_default
INFO:root:      -> Directory exists or was created.
INFO:root:      -> การเขียนไฟล์ทดสอบสำเร็จ.
INFO:root:   Run Mode Selected: FULL_RUN
INFO:root:
--- (Loading) กำลังโหลดและเตรียมข้อมูลสำหรับ FULL_RUN ---
INFO:root:(Loading) กำลังโหลดข้อมูล M15 จาก: /content/drive/MyDrive/Phiradon168/XAUUSD_M15.csv
INFO:root:   ไฟล์ดิบ M15: 118172 แถว
INFO:root:   [Data Quality] ตรวจสอบ % NaN ในคอลัมน์ราคา...
INFO:root:      NaN Percentage:
Open     0.0
High     0.0
Low      0.0
Close    0.0
dtype: float64
INFO:root:   [Data Quality] ตรวจสอบ Duplicates (Date & Timestamp)...
INFO:root:   [Data Quality] ตรวจสอบ Price Jumps (Threshold > 10.0%)...
INFO:root:(Success) โหลดและตรวจสอบข้อมูล M15 สำเร็จ: 118172 แถว
INFO:root:(Loading) กำลังโหลดข้อมูล M1 จาก: /content/drive/MyDrive/Phiradon168/XAUUSD_M1.csv
INFO:root:   ไฟล์ดิบ M1: 321073 แถว
INFO:root:   [Data Quality] ตรวจสอบ % NaN ในคอลัมน์ราคา...
INFO:root:      NaN Percentage:
Open     0.0
High     0.0
Low      0.0
Close    0.0
dtype: float64
INFO:root:   [Data Quality] ตรวจสอบ Duplicates (Date & Timestamp)...
INFO:root:   [Data Quality] ตรวจสอบ Price Jumps (Threshold > 10.0%)...
INFO:root:(Success) โหลดและตรวจสอบข้อมูล M1 สำเร็จ: 321073 แถว
INFO:root:(Processing) กำลังเตรียม Datetime Index (M15)...
INFO:root:   [Preview] First 5 Date + Timestamp format examples:
INFO:root:
25630501 00:00:00
25630501 00:15:00
25630501 00:30:00
25630501 00:45:00
25630501 01:00:00
INFO:root:      [Converter] กำลังตรวจสอบและแปลงปี พ.ศ. เป็น ค.ศ. (ถ้าจำเป็น)...
INFO:root:      [Converter] พบปี พ.ศ. ใน 118172 แถว, กำลังแปลงเป็น ค.ศ....
INFO:root:      [Converter] (Success) แปลงปี พ.ศ. → ค.ศ. แบบ vectorized สำเร็จ.
INFO:root:(Success) เตรียม Datetime index (M15) สำเร็จ. Shape: (118172, 8)
INFO:root:(Processing) กำลังเตรียม Datetime Index (M1)...
INFO:root:   [Preview] First 5 Date + Timestamp format examples:
INFO:root:
25660416 22:00:00
25660416 22:01:00
25660416 22:02:00
25660416 22:03:00
25660416 22:04:00
INFO:root:      [Converter] กำลังตรวจสอบและแปลงปี พ.ศ. เป็น ค.ศ. (ถ้าจำเป็น)...
INFO:root:      [Converter] พบปี พ.ศ. ใน 321073 แถว, กำลังแปลงเป็น ค.ศ....
INFO:root:      [Converter] (Success) แปลงปี พ.ศ. → ค.ศ. แบบ vectorized สำเร็จ.
INFO:root:(Success) เตรียม Datetime index (M1) สำเร็จ. Shape: (321073, 8)
INFO:root:(Processing) กำลังคำนวณ M15 Trend Zone...
INFO:root:      [Cache] ใช้ผลลัพธ์ Trend Zone จาก cache
INFO:root:[QA] Start M1 Feature Engineering
INFO:root:(Processing) กำลังสร้าง Features M1 (v4.9.0)...
INFO:root:   (Processing) Tagging price structure patterns...
INFO:root:      Pattern Label Distribution:
Pattern_Label
Breakout       0.535
Reversal       0.171
Choppy         0.141
InsideBar      0.081
Normal         0.071
StrongTrend    0.002
INFO:root:      Creating 'session' column...
INFO:root:         Session distribution:
session
Asia           0.306
London         0.218
NY             0.214
London/NY      0.131
Other          0.086
Asia/London    0.044
INFO:root:(Success) สร้าง Features M1 (v4.9.0) เสร็จสิ้น.
WARNING:root:[QA WARNING] NaN/Inf detected in engineered features
INFO:root:[QA] M1 Feature Engineering Completed
INFO:root:(Processing) กำลังกำหนด Features M1 สำหรับ Drift และแปลงประเภท (v4.9.0)...
INFO:root:   กำหนด 28 Features M1 สำหรับ Drift: ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Pattern_Label', 'RSI', 'Volatility_Index', 'Wick_Length', 'Wick_Ratio', 'cluster', 'session', 'spike_score']
INFO:root:(Success) กำหนด Features M1 และแปลงประเภท (v4.9.0) เสร็จสิ้น.
INFO:root:(Processing) กำลังรวม M15 Trend Zone...
INFO:root:(Processing) กำลังคำนวณ M1 Entry Signals...
INFO:root:(Processing) กำลังกำหนดคอลัมน์ Simulation ที่จำเป็น...
INFO:root:   (Feature Load) Attempting to load features for 'main' from: ./output_default/features_main.json
INFO:root:      (Success) Loaded 34 features for model 'main' from 'features_main.json'.
INFO:root:(Processing) กำลัง Drop NaN ครั้งสุดท้าย...
INFO:root:   ขนาดข้อมูล M1 สุดท้าย: (321073, 45)
INFO:root:   [RAM Opt] กำลังแปลง Final M1 Data เป็น float32...
INFO:root:   (Success) แปลง 33 Final M1 Data columns เป็น float32 (เท่าที่ทำได้) สำเร็จ.
INFO:root:   (Success) Final M1 Data ผ่านการตรวจสอบ NaN.
INFO:root:[Patch] สร้าง features_main.json จาก M1 Data สำเร็จ (37 features).
INFO:root:
--- (FULL_RUN) ตรวจสอบ/Train Models ที่ขาดหาย ---
INFO:root:
--- (Auto-Train Check) Ensuring Model Files Exist ---
WARNING:root:Missing model file for 'spike' (meta_classifier_spike.pkl).
WARNING:root:Missing model file for 'cluster' (meta_classifier_cluster.pkl).
WARNING:root:   Triggering Auto-Training for Missing Models: ['spike', 'cluster']
INFO:root:      (safe_load) Attempting to load: trade_log_v32_walkforward.csv.gz
INFO:root:
(Training - v5.4.7) เริ่มต้นการ Train Meta Classifier (Purpose: SPIKE)...
INFO:root:   Model Type: catboost
INFO:root:   Sample Size Limit: 60000
INFO:root:   Features to Drop Before Final Train: None
INFO:root:   Dynamic Feature Selection: เปิดใช้งาน
INFO:root:     Method: SHAP
INFO:root:     SHAP Threshold: 0.0100
INFO:root:     Permutation Threshold: 0.0010
INFO:root:   Optuna Tuning: ปิดใช้งาน
INFO:root:   Drift Observer Provided: No
INFO:root:   Early Stopping Rounds: 200
INFO:root:   GPU Acceleration Available: False. Setting CatBoost task_type to: 'CPU' (for applicable steps).
INFO:root:   ใช้ Trade Log ที่ Filter แล้ว (Override) จำนวน 299 แถว สำหรับ Model Purpose: SPIKE
INFO:root:   กำลังประมวลผล Trade Log สำหรับ Training...
INFO:root:   Target (is_tp from Log) Distribution:
is_tp
0    0.9
1    0.1
INFO:root:   ประมวลผล Trade Log สำเร็จ (299 trades).
INFO:root:   กำลังโหลด M1 Data: ./output_default/final_data_m1_v32_walkforward.csv.gz
INFO:root:      (safe_load) Attempting to load: final_data_m1_v32_walkforward.csv.gz
INFO:root:   โหลดและเตรียม M1 สำเร็จ (321073 แถว). จำนวน Features เริ่มต้น: 46
INFO:root:   กำลังเตรียมข้อมูลสำหรับ Meta Model Training (Purpose: SPIKE)...
INFO:root:   กำลังรวม Trade Log กับ M1 Features (merge_asof)...
INFO:root:[Patch] เริ่ม Merge Trade Log กับ M1 Features (merge_asof)
INFO:root:   Merge completed. Shape after merge: (299, 90)
INFO:root:[Patch] Available Features หลัง Merge: 36 รายการ
INFO:root:[Patch] Missing Features หลัง Merge: 1 รายการ: ['Signal_Score']
INFO:root:   Features เริ่มต้นสำหรับการเลือก (36): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Long', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'cluster', 'spike_score']
INFO:root:   [NaN Check] ก่อน Drop NaN ใน Merged Data (Features/Target): 299 แถว
INFO:root:   (Success) การรวมข้อมูลเสร็จสมบูรณ์ (299 samples before sampling).
INFO:root:   (Info) Sample size (60000) >= data size (299). Using all data.
INFO:root:
   --- [Phase 2/B] กำลังดำเนินการ Dynamic Feature Selection ---
INFO:root:      (Info) ไม่พบ Categorical Feature 'Pattern_Label' สำหรับ Prelim Model.
INFO:root:      [NaN Check] ตรวจสอบ NaN/Inf ในข้อมูล Feature Selection (X_select)...
INFO:root:         เติม NaN/Inf ใน X_select สำเร็จ.
INFO:root:      กำลัง Train Preliminary Model (สำหรับ Feature Importance)...
INFO:root:         (ใช้ Default Prelim Params)
INFO:root:         (Prelim Task Type: CPU)
INFO:root:[Before Prelim Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.3% (1931MB / 12977MB)
INFO:root:[After Prelim Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.3% (1930MB / 12977MB)
INFO:root:      (Success) Train Preliminary Model สำเร็จ.
INFO:root:      กำลังคำนวณ SHAP Importance...
INFO:root:   [SHAP Select] กำลังเลือก Features ที่มี Normalized SHAP >= 0.0100...
INFO:root:      (Success) เลือก Features ได้ 34 ตัวจาก SHAP.
INFO:root:         Features ที่ถูกตัดออก 2 ตัว: ['Entry_Long', 'cluster']
INFO:root:         Features ที่เลือก (เรียงตามค่า SHAP):
INFO:root:
           Feature  Normalized_SHAP
              Date          0.09669
        Upper_Wick          0.07374
       spike_score          0.04773
             Close          0.04722
ATR_14_Rolling_Avg          0.04710
               RSI          0.04475
         MACD_hist          0.03767
               ADX          0.03695
              High          0.03653
  Volatility_Index          0.03564
               Low          0.03317
              Open          0.03200
       MACD_signal          0.02957
      Candle_Range          0.02820
    ATR_14_Shifted          0.02594
 Candle_Speed_lag3          0.02535
  MACD_hist_smooth          0.02503
       Gain_Z_lag5          0.02309
              Gain          0.02245
       Gain_Z_lag1          0.02210
        Wick_Ratio          0.02186
 Candle_Speed_lag1          0.02181
       Candle_Body          0.01963
 Candle_Speed_lag5          0.01947
       Wick_Length          0.01754
       Gain_Z_lag3          0.01632
            Volume          0.01624
      Candle_Ratio          0.01500
         MACD_line          0.01495
            ATR_14          0.01212
      Candle_Speed          0.01166
            Gain_Z          0.01049
        Lower_Wick          0.01040
       Entry_Short          0.01002
INFO:root:      Features ที่เลือกโดย SHAP (34): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'spike_score']
INFO:root:      พิจารณาเพิ่ม Lag Features ที่สำคัญ...
INFO:root:         Lag Features ที่มีให้พิจารณา: ['Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5']
WARNING:root:Cannot evaluate Lag Features: catboost/libs/data/model_dataset_compatibility.cpp:72: Feature Candle_Body is present in model but not in pool.
INFO:root:   --- [Phase 2/B] Final Selected Features (34): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'spike_score'] ---
INFO:root:
   กำลังเตรียมข้อมูล Training สุดท้ายด้วย Features ที่เลือก (34 ตัว)...
INFO:root:      [NaN Check] ตรวจสอบ NaN/Inf ในข้อมูล Final Training (X)...
INFO:root:         เติม NaN/Inf ใน X (Final) สำเร็จ.
INFO:root:      [RAM Opt] Converting Final Training Features (X) to float32 (Before Split)...
INFO:root:      (Success) แปลง 32 Final Training Features เป็น float32 (เท่าที่ทำได้) สำเร็จ.
INFO:root:
   --- [Phase 3/A] ข้าม Hyperparameter Optimization (Optuna ปิดใช้งาน หรือ Model ไม่ใช่ CatBoost) ---
INFO:root:
   --- Training Final CatBoost Model (Purpose: SPIKE) ---
INFO:root:      (Info) ไม่พบ 'Pattern_Label' ใน Features ที่เลือกสุดท้าย.
INFO:root:      Splitting data into Train/Validation sets (80/20 stratified)...
INFO:root:      Train Size (Final): 239, Validation Size (Final): 60
INFO:root:      Validation Target Distribution (Final):
is_tp
0    0.9
1    0.1
INFO:root:      [RAM Opt] Converting Train/Validation sets to float32 (After Split)...
INFO:root:      กำลังกำหนด Final Model Parameters...
INFO:root:         Using Fixed Params (v4.7.1)...
INFO:root:         Final Params: {'iterations': 3000, 'learning_rate': 0.01, 'depth': 4, 'l2_leaf_reg': 30, 'eval_metric': 'AUC', 'auto_class_weights': 'Balanced', 'early_stopping_rounds': 200, 'random_seed': 42, 'verbose': 100, 'loss_function': 'Logloss', 'task_type': 'CPU'}
INFO:root:      Fitting Final CatBoost model (Purpose: SPIKE)...
INFO:root:[Before Final Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.4% (1938MB / 12977MB)
0:	test: 0.7746914	best: 0.7746914 (0)	total: 2.72ms	remaining: 8.16s
100:	test: 0.7067901	best: 0.7746914 (0)	total: 177ms	remaining: 5.08s
200:	test: 0.7098765	best: 0.7746914 (0)	total: 362ms	remaining: 5.04s
Stopped by overfitting detector  (200 iterations wait)

bestTest = 0.774691358
bestIteration = 0

Shrink model to first 1 iterations.
INFO:root:[After Final Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.4% (1937MB / 12977MB)
INFO:root:      (Success) Final CatBoost training (Purpose: SPIKE) finished in 0.41 seconds.
INFO:root:
      --- Model Quality Check (Final CatBoost Model) ---
INFO:root:   [Check] Checking for Overfitting (AUC)...
INFO:root:      Val AUC:   0.7747
INFO:root:   [Check] Checking for Overfitting (LogLoss)...
INFO:root:      Val LogLoss:   0.6908
INFO:root:      Validation Metrics (Final Model - Purpose: SPIKE):
INFO:root:         Accuracy:  0.6000
INFO:root:         AUC:       0.7747
INFO:root:         LogLoss:   0.6908
INFO:root:         Classification Report:
              precision    recall  f1-score   support

      Not TP       1.00      0.56      0.71        54
          TP       0.20      1.00      0.33         6

    accuracy                           0.60        60
   macro avg       0.60      0.78      0.52        60
weighted avg       0.92      0.60      0.68        60

INFO:root:
      --- SHAP Analysis (Final Model - Validation Set - Purpose: SPIKE) ---
INFO:root:
(Analyzing) SHAP analysis (CatBoostClassifier - Sample Size: 60) -  Validation Set...
INFO:root:      Calculating SHAP values (CatBoost)...
INFO:root:      Creating SHAP Summary Plot (bar type)...
INFO:root:      (Success) Saved SHAP Plot (Bar): shap_summary_CatBoostClassifier_bar_validation_set.png
INFO:root:      Creating SHAP Summary Plot (beeswarm/dot type)...
INFO:root:      (Success) Saved SHAP Plot (Beeswarm): shap_summary_CatBoostClassifier_beeswarm_validation_set.png
INFO:root:
         --- Feature Noise Check (SHAP - Final Model - Validation Set) ---
INFO:root:            Recalculating SHAP values for Noise Check (Validation Set)...
INFO:root:   [Check] Checking for Feature Noise (SHAP)...
INFO:root:[Patch] SHAP Noise features detected: ['ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'spike_score']
INFO:root:
   --- Saving Final Model (Purpose: SPIKE) ---
INFO:root:      (Success) Saved Final CATBOOST (Purpose: SPIKE): ./output_default/meta_classifier_spike.pkl
INFO:root:   Saving final selected features (34) for 'spike' to: ./output_default/features_spike.json
INFO:root:   (Success) Saved final features list for 'spike'.
INFO:root:(Finished - v5.4.7) Meta Classifier Training (Purpose: SPIKE) complete in 12.13 seconds.
INFO:root:
(Training - v5.4.7) เริ่มต้นการ Train Meta Classifier (Purpose: CLUSTER)...
INFO:root:   Model Type: catboost
INFO:root:   Sample Size Limit: 60000
INFO:root:   Features to Drop Before Final Train: None
INFO:root:   Dynamic Feature Selection: เปิดใช้งาน
INFO:root:     Method: SHAP
INFO:root:     SHAP Threshold: 0.0100
INFO:root:     Permutation Threshold: 0.0010
INFO:root:   Optuna Tuning: ปิดใช้งาน
INFO:root:   Drift Observer Provided: No
INFO:root:   Early Stopping Rounds: 200
INFO:root:   GPU Acceleration Available: False. Setting CatBoost task_type to: 'CPU' (for applicable steps).
INFO:root:   ใช้ Trade Log ที่ Filter แล้ว (Override) จำนวน 299 แถว สำหรับ Model Purpose: CLUSTER
INFO:root:   กำลังประมวลผล Trade Log สำหรับ Training...
INFO:root:   Target (is_tp from Log) Distribution:
is_tp
0    0.9
1    0.1
INFO:root:   ประมวลผล Trade Log สำเร็จ (299 trades).
INFO:root:   กำลังโหลด M1 Data: ./output_default/final_data_m1_v32_walkforward.csv.gz
INFO:root:      (safe_load) Attempting to load: final_data_m1_v32_walkforward.csv.gz
INFO:root:   โหลดและเตรียม M1 สำเร็จ (321073 แถว). จำนวน Features เริ่มต้น: 46
INFO:root:   กำลังเตรียมข้อมูลสำหรับ Meta Model Training (Purpose: CLUSTER)...
INFO:root:   กำลังรวม Trade Log กับ M1 Features (merge_asof)...
INFO:root:[Patch] เริ่ม Merge Trade Log กับ M1 Features (merge_asof)
INFO:root:   Merge completed. Shape after merge: (299, 90)
INFO:root:[Patch] Available Features หลัง Merge: 36 รายการ
INFO:root:[Patch] Missing Features หลัง Merge: 1 รายการ: ['Signal_Score']
INFO:root:   Features เริ่มต้นสำหรับการเลือก (36): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Long', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'cluster', 'spike_score']
INFO:root:   [NaN Check] ก่อน Drop NaN ใน Merged Data (Features/Target): 299 แถว
INFO:root:   (Success) การรวมข้อมูลเสร็จสมบูรณ์ (299 samples before sampling).
INFO:root:   (Info) Sample size (60000) >= data size (299). Using all data.
INFO:root:
   --- [Phase 2/B] กำลังดำเนินการ Dynamic Feature Selection ---
INFO:root:      (Info) ไม่พบ Categorical Feature 'Pattern_Label' สำหรับ Prelim Model.
INFO:root:      [NaN Check] ตรวจสอบ NaN/Inf ในข้อมูล Feature Selection (X_select)...
INFO:root:         เติม NaN/Inf ใน X_select สำเร็จ.
INFO:root:      กำลัง Train Preliminary Model (สำหรับ Feature Importance)...
INFO:root:         (ใช้ Default Prelim Params)
INFO:root:         (Prelim Task Type: CPU)
INFO:root:[Before Prelim Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.3% (1922MB / 12977MB)
INFO:root:[After Prelim Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.4% (1933MB / 12977MB)
INFO:root:      (Success) Train Preliminary Model สำเร็จ.
INFO:root:      กำลังคำนวณ SHAP Importance...
INFO:root:   [SHAP Select] กำลังเลือก Features ที่มี Normalized SHAP >= 0.0100...
INFO:root:      (Success) เลือก Features ได้ 34 ตัวจาก SHAP.
INFO:root:         Features ที่ถูกตัดออก 2 ตัว: ['Entry_Long', 'cluster']
INFO:root:         Features ที่เลือก (เรียงตามค่า SHAP):
INFO:root:
           Feature  Normalized_SHAP
              Date          0.09669
        Upper_Wick          0.07374
       spike_score          0.04773
             Close          0.04722
ATR_14_Rolling_Avg          0.04710
               RSI          0.04475
         MACD_hist          0.03767
               ADX          0.03695
              High          0.03653
  Volatility_Index          0.03564
               Low          0.03317
              Open          0.03200
       MACD_signal          0.02957
      Candle_Range          0.02820
    ATR_14_Shifted          0.02594
 Candle_Speed_lag3          0.02535
  MACD_hist_smooth          0.02503
       Gain_Z_lag5          0.02309
              Gain          0.02245
       Gain_Z_lag1          0.02210
        Wick_Ratio          0.02186
 Candle_Speed_lag1          0.02181
       Candle_Body          0.01963
 Candle_Speed_lag5          0.01947
       Wick_Length          0.01754
       Gain_Z_lag3          0.01632
            Volume          0.01624
      Candle_Ratio          0.01500
         MACD_line          0.01495
            ATR_14          0.01212
      Candle_Speed          0.01166
            Gain_Z          0.01049
        Lower_Wick          0.01040
       Entry_Short          0.01002
INFO:root:      Features ที่เลือกโดย SHAP (34): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'spike_score']
INFO:root:      พิจารณาเพิ่ม Lag Features ที่สำคัญ...
INFO:root:         Lag Features ที่มีให้พิจารณา: ['Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5']
WARNING:root:Cannot evaluate Lag Features: catboost/libs/data/model_dataset_compatibility.cpp:72: Feature Candle_Body is present in model but not in pool.
INFO:root:   --- [Phase 2/B] Final Selected Features (34): ['ADX', 'ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Date', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'Gain_Z_lag5', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'RSI', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'spike_score'] ---
INFO:root:
   กำลังเตรียมข้อมูล Training สุดท้ายด้วย Features ที่เลือก (34 ตัว)...
INFO:root:      [NaN Check] ตรวจสอบ NaN/Inf ในข้อมูล Final Training (X)...
INFO:root:         เติม NaN/Inf ใน X (Final) สำเร็จ.
INFO:root:      [RAM Opt] Converting Final Training Features (X) to float32 (Before Split)...
INFO:root:      (Success) แปลง 32 Final Training Features เป็น float32 (เท่าที่ทำได้) สำเร็จ.
INFO:root:
   --- [Phase 3/A] ข้าม Hyperparameter Optimization (Optuna ปิดใช้งาน หรือ Model ไม่ใช่ CatBoost) ---
INFO:root:
   --- Training Final CatBoost Model (Purpose: CLUSTER) ---
INFO:root:      (Info) ไม่พบ 'Pattern_Label' ใน Features ที่เลือกสุดท้าย.
INFO:root:      Splitting data into Train/Validation sets (80/20 stratified)...
INFO:root:      Train Size (Final): 239, Validation Size (Final): 60
INFO:root:      Validation Target Distribution (Final):
is_tp
0    0.9
1    0.1
INFO:root:      [RAM Opt] Converting Train/Validation sets to float32 (After Split)...
INFO:root:      กำลังกำหนด Final Model Parameters...
INFO:root:         Using Fixed Params (v4.7.1)...
INFO:root:         Final Params: {'iterations': 3000, 'learning_rate': 0.01, 'depth': 4, 'l2_leaf_reg': 30, 'eval_metric': 'AUC', 'auto_class_weights': 'Balanced', 'early_stopping_rounds': 200, 'random_seed': 42, 'verbose': 100, 'loss_function': 'Logloss', 'task_type': 'CPU'}
INFO:root:      Fitting Final CatBoost model (Purpose: CLUSTER)...
INFO:root:[Before Final Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.4% (1933MB / 12977MB)
0:	test: 0.7746914	best: 0.7746914 (0)	total: 2.6ms	remaining: 7.8s
100:	test: 0.7067901	best: 0.7746914 (0)	total: 199ms	remaining: 5.71s
200:	test: 0.7098765	best: 0.7746914 (0)	total: 395ms	remaining: 5.49s
Stopped by overfitting detector  (200 iterations wait)

bestTest = 0.774691358
bestIteration = 0

Shrink model to first 1 iterations.
INFO:root:[After Final Fit] GPU Util: 0% | Mem: 0% (267MB / 15360MB) | RAM: 17.4% (1933MB / 12977MB)
INFO:root:      (Success) Final CatBoost training (Purpose: CLUSTER) finished in 0.44 seconds.
INFO:root:
      --- Model Quality Check (Final CatBoost Model) ---
INFO:root:   [Check] Checking for Overfitting (AUC)...
INFO:root:      Val AUC:   0.7747
INFO:root:   [Check] Checking for Overfitting (LogLoss)...
INFO:root:      Val LogLoss:   0.6908
INFO:root:      Validation Metrics (Final Model - Purpose: CLUSTER):
INFO:root:         Accuracy:  0.6000
INFO:root:         AUC:       0.7747
INFO:root:         LogLoss:   0.6908
INFO:root:         Classification Report:
              precision    recall  f1-score   support

      Not TP       1.00      0.56      0.71        54
          TP       0.20      1.00      0.33         6

    accuracy                           0.60        60
   macro avg       0.60      0.78      0.52        60
weighted avg       0.92      0.60      0.68        60

INFO:root:
      --- SHAP Analysis (Final Model - Validation Set - Purpose: CLUSTER) ---
INFO:root:
(Analyzing) SHAP analysis (CatBoostClassifier - Sample Size: 60) -  Validation Set...
INFO:root:      Calculating SHAP values (CatBoost)...
INFO:root:      Creating SHAP Summary Plot (bar type)...
INFO:root:      (Success) Saved SHAP Plot (Bar): shap_summary_CatBoostClassifier_bar_validation_set.png
INFO:root:      Creating SHAP Summary Plot (beeswarm/dot type)...
INFO:root:      (Success) Saved SHAP Plot (Beeswarm): shap_summary_CatBoostClassifier_beeswarm_validation_set.png
INFO:root:
         --- Feature Noise Check (SHAP - Final Model - Validation Set) ---
INFO:root:            Recalculating SHAP values for Noise Check (Validation Set)...
INFO:root:   [Check] Checking for Feature Noise (SHAP)...
INFO:root:[Patch] SHAP Noise features detected: ['ATR_14', 'ATR_14_Rolling_Avg', 'ATR_14_Shifted', 'Candle_Body', 'Candle_Range', 'Candle_Ratio', 'Candle_Speed', 'Candle_Speed_lag1', 'Candle_Speed_lag3', 'Candle_Speed_lag5', 'Close', 'Entry_Short', 'Gain', 'Gain_Z', 'Gain_Z_lag1', 'Gain_Z_lag3', 'High', 'Low', 'Lower_Wick', 'MACD_hist', 'MACD_hist_smooth', 'MACD_line', 'MACD_signal', 'Open', 'Upper_Wick', 'Volatility_Index', 'Volume', 'Wick_Length', 'Wick_Ratio', 'spike_score']
INFO:root:
   --- Saving Final Model (Purpose: CLUSTER) ---
INFO:root:      (Success) Saved Final CATBOOST (Purpose: CLUSTER): ./output_default/meta_classifier_cluster.pkl
INFO:root:   Saving final selected features (34) for 'cluster' to: ./output_default/features_cluster.json
INFO:root:   (Success) Saved final features list for 'cluster'.
INFO:root:(Finished - v5.4.7) Meta Classifier Training (Purpose: CLUSTER) complete in 13.43 seconds.
INFO:root:--- (Auto-Train Check) Finished ---
INFO:root:
--- กำลังโหลด Models และ Features สำหรับ FULL_RUN (Model Switcher) ---
INFO:root:(Loading) พยายามโหลด Model 'main' จาก: ./output_default/meta_classifier.pkl
INFO:root:  (Success) โหลด Model 'main' (CatBoostClassifier) สำเร็จ.
INFO:root:(Loading) พยายามโหลด Features สำหรับ 'main'...
INFO:root:   (Feature Load) Attempting to load features for 'main' from: ./output_default/features_main.json
INFO:root:      (Success) Loaded 37 features for model 'main' from 'features_main.json'.
INFO:root:  (Success) โหลด Features (37) สำหรับ Model 'main' สำเร็จ.
INFO:root:(Loading) พยายามโหลด Model 'spike' จาก: ./output_default/meta_classifier_spike.pkl
INFO:root:  (Success) โหลด Model 'spike' (CatBoostClassifier) สำเร็จ.
INFO:root:(Loading) พยายามโหลด Features สำหรับ 'spike'...
INFO:root:   (Feature Load) Attempting to load features for 'spike' from: ./output_default/features_spike.json
INFO:root:      (Success) Loaded 34 features for model 'spike' from 'features_spike.json'.
INFO:root:  (Success) โหลด Features (34) สำหรับ Model 'spike' สำเร็จ.
INFO:root:(Loading) พยายามโหลด Model 'cluster' จาก: ./output_default/meta_classifier_cluster.pkl
INFO:root:  (Success) โหลด Model 'cluster' (CatBoostClassifier) สำเร็จ.
INFO:root:(Loading) พยายามโหลด Features สำหรับ 'cluster'...
INFO:root:   (Feature Load) Attempting to load features for 'cluster' from: ./output_default/features_cluster.json
INFO:root:      (Success) Loaded 34 features for model 'cluster' from 'features_cluster.json'.
INFO:root:  (Success) โหลด Features (34) สำหรับ Model 'cluster' สำเร็จ.
INFO:root:--- โหลด Models/Features เสร็จสิ้น: ['main', 'spike', 'cluster'] ---
INFO:root:   (DriftObserver) Initialized with 28 features to observe.
INFO:root:
(Info) ข้าม Auto Threshold Tuning (ใช้ Fixed Params สำหรับ Model).
INFO:root:
(Multi-Fund Mode) กำลังรันสำหรับ 5 Fund Profiles: ['SAFE', 'NORMAL', 'SPIKE', 'AGGRESSIVE', 'MIRROR']
INFO:root:
==================== STARTING FUND: SAFE (MM Mode: conservative) ====================
INFO:root:--- FINAL WALK-FORWARD RUN (Fund: SAFE, Suffix: _SAFE_fixed_params_switcher_on) ---
INFO:root:      [Runner (Final Run - Fund: SAFE)] เริ่มต้น Full WF Sim (L1_Th=0.50)
INFO:root:      Initializing TimeSeriesSplit with n_splits=5
INFO:root:      Starting Walk-Forward loop (5 folds)...
Running folds:   0%|          | 0/5 [00:00<?, ?fold/s]
INFO:root:
=============== Fold 1/5 ((Final Run - Fund: SAFE)) ===============
INFO:root:          Train period size: 53513
INFO:root:          Test period: 2023-06-08 18:35:00+00:00 to 2023-08-02 19:13:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 1...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 1 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 1.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=1, Wasserstein=0.5939 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=1, Wasserstein=0.6332 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=1, T-test p=0.0280 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 1 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 1. Mean Wasserstein: 0.0874
INFO:root:          Adjusting parameters based on drift for Fold 1...
WARNING:root:          (Drift Override) RSI Drift (0.6332 > 0.30) detected. Ignoring RSI scoring for Fold 1.
INFO:root:          Starting Capital Fold 1: BUY=$100.00, SELL=$100.00 (Initial)
INFO:root:   -- Running BUY Simulation Fold 1 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_BUY_SAFE (BUY), Fold: 1, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_BUY_SAFE (53512 bars)...
  Sim (Fold0_BUY_SAFE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:36:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_BUY_SAFE at index 2023-06-08 18:36:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_BUY_SAFE.
INFO:root:Created trade log DataFrame for Fold0_BUY_SAFE with 0 entries.
INFO:root:  (Finished) Fold0_BUY_SAFE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 1 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_SELL_SAFE (SELL), Fold: 1, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_SELL_SAFE (53512 bars)...
  Sim (Fold0_SELL_SAFE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 268, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-06-09 00:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_SELL_SAFE at index 2023-06-09 00:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_SELL_SAFE.
INFO:root:Created trade log DataFrame for Fold0_SELL_SAFE with 0 entries.
INFO:root:  (Finished) Fold0_SELL_SAFE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 1 (SAFE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Buy (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Buy (SAFE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Sell (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Sell (SAFE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 1 (SAFE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 1/5 (SAFE) ===============
WARNING:root:   (Metrics) Fold 1 processed in: 7.41 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 2/5 ((Final Run - Fund: SAFE)) ===============
INFO:root:          Train period size: 107025
INFO:root:          Test period: 2023-08-02 19:14:00+00:00 to 2023-09-26 19:58:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 2...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 2 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 2.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=2, Wasserstein=0.2364 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='ATR_14', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, Wasserstein=0.1495 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, Wasserstein=0.1504 > 0.10
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=2, Wasserstein=0.1014 > 0.10
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=2, Wasserstein=0.7809 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 2 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=2
INFO:root:          Drift Analysis complete for Fold 2. Mean Wasserstein: 0.0994
INFO:root:          Adjusting parameters based on drift for Fold 2...
WARNING:root:          (Drift Override) RSI Drift (0.7809 > 0.30) detected. Ignoring RSI scoring for Fold 2.
INFO:root:          Starting Capital Fold 2: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 2 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_BUY_SAFE (BUY), Fold: 2, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_BUY_SAFE (53512 bars)...
  Sim (Fold1_BUY_SAFE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:27:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_BUY_SAFE at index 2023-08-02 19:27:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_BUY_SAFE.
INFO:root:Created trade log DataFrame for Fold1_BUY_SAFE with 0 entries.
INFO:root:  (Finished) Fold1_BUY_SAFE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 2 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_SELL_SAFE (SELL), Fold: 2, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_SELL_SAFE (53512 bars)...
  Sim (Fold1_SELL_SAFE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:24:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_SELL_SAFE at index 2023-08-02 19:24:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_SELL_SAFE.
INFO:root:Created trade log DataFrame for Fold1_SELL_SAFE with 0 entries.
INFO:root:  (Finished) Fold1_SELL_SAFE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 2 (SAFE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Buy (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Buy (SAFE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Sell (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Sell (SAFE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 2 (SAFE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 2/5 (SAFE) ===============
WARNING:root:   (Metrics) Fold 2 processed in: 6.39 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 3/5 ((Final Run - Fund: SAFE)) ===============
INFO:root:          Train period size: 160537
INFO:root:          Test period: 2023-09-26 19:59:00+00:00 to 2023-11-20 16:16:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 3...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 3 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 3.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=3, Wasserstein=0.2073 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=3, T-test p=0.0001 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=3, Wasserstein=1.1380 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 3 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 3. Mean Wasserstein: 0.0686
INFO:root:          Adjusting parameters based on drift for Fold 3...
WARNING:root:          (Drift Override) RSI Drift (1.1380 > 0.30) detected. Ignoring RSI scoring for Fold 3.
INFO:root:          Starting Capital Fold 3: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 3 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_BUY_SAFE (BUY), Fold: 3, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_BUY_SAFE (53512 bars)...
  Sim (Fold2_BUY_SAFE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_BUY_SAFE at index 2023-09-26 20:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_BUY_SAFE.
INFO:root:Created trade log DataFrame for Fold2_BUY_SAFE with 0 entries.
INFO:root:  (Finished) Fold2_BUY_SAFE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 3 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_SELL_SAFE (SELL), Fold: 3, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_SELL_SAFE (53512 bars)...
  Sim (Fold2_SELL_SAFE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:04:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_SELL_SAFE at index 2023-09-26 20:04:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_SELL_SAFE.
INFO:root:Created trade log DataFrame for Fold2_SELL_SAFE with 0 entries.
INFO:root:  (Finished) Fold2_SELL_SAFE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 3 (SAFE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Buy (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Buy (SAFE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Sell (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Sell (SAFE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 3 (SAFE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 3/5 (SAFE) ===============
WARNING:root:   (Metrics) Fold 3 processed in: 7.36 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 4/5 ((Final Run - Fund: SAFE)) ===============
INFO:root:          Train period size: 214049
INFO:root:          Test period: 2023-11-20 16:17:00+00:00 to 2024-01-16 21:35:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 4...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 4 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 4.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=4, Wasserstein=0.1807 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=4, T-test p=0.0015 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=4, T-test p=0.0018 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=4, T-test p=0.0009 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=4, Wasserstein=1.3158 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 4 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 4. Mean Wasserstein: 0.0935
INFO:root:          Adjusting parameters based on drift for Fold 4...
WARNING:root:          (Drift Override) RSI Drift (1.3158 > 0.30) detected. Ignoring RSI scoring for Fold 4.
INFO:root:          Starting Capital Fold 4: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 4 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_BUY_SAFE (BUY), Fold: 4, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_BUY_SAFE (53512 bars)...
  Sim (Fold3_BUY_SAFE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:19:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_BUY_SAFE at index 2023-11-20 16:19:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_BUY_SAFE.
INFO:root:Created trade log DataFrame for Fold3_BUY_SAFE with 0 entries.
INFO:root:  (Finished) Fold3_BUY_SAFE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 4 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_SELL_SAFE (SELL), Fold: 4, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_SELL_SAFE (53512 bars)...
  Sim (Fold3_SELL_SAFE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 1.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.70
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 916, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 08:33:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_SELL_SAFE at index 2023-11-21 08:33:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_SELL_SAFE.
INFO:root:Created trade log DataFrame for Fold3_SELL_SAFE with 0 entries.
INFO:root:  (Finished) Fold3_SELL_SAFE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 4 (SAFE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Buy (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Buy (SAFE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Sell (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Sell (SAFE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 4 (SAFE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 4/5 (SAFE) ===============
WARNING:root:   (Metrics) Fold 4 processed in: 11.22 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 5/5 ((Final Run - Fund: SAFE)) ===============
INFO:root:          Train period size: 267561
INFO:root:          Test period: 2024-01-16 21:36:00+00:00 to 2024-03-11 18:21:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 5...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 5 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 5.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=5, Wasserstein=0.7486 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=5, Wasserstein=2.0210 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=5, T-test p=0.0236 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 5 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 5. Mean Wasserstein: 0.1159
INFO:root:          Adjusting parameters based on drift for Fold 5...
WARNING:root:          (Drift Override) RSI Drift (2.0210 > 0.30) detected. Ignoring RSI scoring for Fold 5.
INFO:root:          Starting Capital Fold 5: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 5 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_BUY_SAFE (BUY), Fold: 5, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_BUY_SAFE (53512 bars)...
  Sim (Fold4_BUY_SAFE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:44:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_BUY_SAFE at index 2024-01-16 21:44:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_BUY_SAFE.
INFO:root:Created trade log DataFrame for Fold4_BUY_SAFE with 0 entries.
INFO:root:  (Finished) Fold4_BUY_SAFE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 5 (SAFE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_SELL_SAFE (SELL), Fold: 5, Capital:$100.00, MM Mode:'conservative'(Risk:0.005), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_SELL_SAFE (53512 bars)...
  Sim (Fold4_SELL_SAFE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2024-01-16 21:41:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_SELL_SAFE at index 2024-01-16 21:41:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_SELL_SAFE.
INFO:root:Created trade log DataFrame for Fold4_SELL_SAFE with 0 entries.
INFO:root:  (Finished) Fold4_SELL_SAFE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 5 (SAFE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Buy (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Buy (SAFE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Sell (SAFE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Sell (SAFE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 5 (SAFE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 5/5 (SAFE) ===============
WARNING:root:   (Metrics) Fold 5 processed in: 7.71 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:      [Runner (Final Run - Fund: SAFE)] (Success) Full WF Sim completed (L1_Th=0.50) in 41.04 seconds.
ERROR:root:      [Runner (Final Run - Fund: SAFE)] (Error) No trades were logged in any fold (L1_Th=0.50). Cannot aggregate results.
INFO:root:
(Aggregating) กำลังรวมผลลัพธ์ Final Walk-Forward Run (Fund: SAFE)...
ERROR:root:(Error) Final Walk-Forward Run (Fund: SAFE) ล้มเหลว หรือไม่ได้สร้าง Metrics.
INFO:root:
==================== STARTING FUND: NORMAL (MM Mode: balanced) ====================
INFO:root:--- FINAL WALK-FORWARD RUN (Fund: NORMAL, Suffix: _NORMAL_fixed_params_switcher_on) ---
INFO:root:      [Runner (Final Run - Fund: NORMAL)] เริ่มต้น Full WF Sim (L1_Th=0.50)
INFO:root:      Initializing TimeSeriesSplit with n_splits=5
INFO:root:      Starting Walk-Forward loop (5 folds)...
Running folds:   0%|          | 0/5 [00:00<?, ?fold/s]
INFO:root:
=============== Fold 1/5 ((Final Run - Fund: NORMAL)) ===============
INFO:root:          Train period size: 53513
INFO:root:          Test period: 2023-06-08 18:35:00+00:00 to 2023-08-02 19:13:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 1...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 1 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 1.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=1, Wasserstein=0.5939 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=1, Wasserstein=0.6332 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=1, T-test p=0.0280 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 1 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 1. Mean Wasserstein: 0.0874
INFO:root:          Adjusting parameters based on drift for Fold 1...
WARNING:root:          (Drift Override) RSI Drift (0.6332 > 0.30) detected. Ignoring RSI scoring for Fold 1.
INFO:root:          Starting Capital Fold 1: BUY=$100.00, SELL=$100.00 (Initial)
INFO:root:   -- Running BUY Simulation Fold 1 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_BUY_NORMAL (BUY), Fold: 1, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_BUY_NORMAL (53512 bars)...
  Sim (Fold0_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:36:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_BUY_NORMAL at index 2023-06-08 18:36:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_BUY_NORMAL.
INFO:root:Created trade log DataFrame for Fold0_BUY_NORMAL with 0 entries.
INFO:root:  (Finished) Fold0_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 1 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_SELL_NORMAL (SELL), Fold: 1, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_SELL_NORMAL (53512 bars)...
  Sim (Fold0_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 268, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-06-09 00:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_SELL_NORMAL at index 2023-06-09 00:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_SELL_NORMAL.
INFO:root:Created trade log DataFrame for Fold0_SELL_NORMAL with 0 entries.
INFO:root:  (Finished) Fold0_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 1 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Buy (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Buy (NORMAL)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Sell (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Sell (NORMAL)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 1 (NORMAL): No trades opened. All entries blocked.
WARNING:root:=============== Fold 1/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 1 processed in: 7.31 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 2/5 ((Final Run - Fund: NORMAL)) ===============
INFO:root:          Train period size: 107025
INFO:root:          Test period: 2023-08-02 19:14:00+00:00 to 2023-09-26 19:58:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 2...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 2 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 2.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=2, Wasserstein=0.2364 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='ATR_14', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, Wasserstein=0.1495 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, Wasserstein=0.1504 > 0.10
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=2, Wasserstein=0.1014 > 0.10
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=2, Wasserstein=0.7809 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 2 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=2
INFO:root:          Drift Analysis complete for Fold 2. Mean Wasserstein: 0.0994
INFO:root:          Adjusting parameters based on drift for Fold 2...
WARNING:root:          (Drift Override) RSI Drift (0.7809 > 0.30) detected. Ignoring RSI scoring for Fold 2.
INFO:root:          Starting Capital Fold 2: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 2 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_BUY_NORMAL (BUY), Fold: 2, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_BUY_NORMAL (53512 bars)...
  Sim (Fold1_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:27:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_BUY_NORMAL at index 2023-08-02 19:27:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_BUY_NORMAL.
INFO:root:Created trade log DataFrame for Fold1_BUY_NORMAL with 0 entries.
INFO:root:  (Finished) Fold1_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 2 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_SELL_NORMAL (SELL), Fold: 2, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_SELL_NORMAL (53512 bars)...
  Sim (Fold1_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:24:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_SELL_NORMAL at index 2023-08-02 19:24:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_SELL_NORMAL.
INFO:root:Created trade log DataFrame for Fold1_SELL_NORMAL with 0 entries.
INFO:root:  (Finished) Fold1_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 2 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Buy (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Buy (NORMAL)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Sell (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Sell (NORMAL)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 2 (NORMAL): No trades opened. All entries blocked.
WARNING:root:=============== Fold 2/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 2 processed in: 6.35 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 3/5 ((Final Run - Fund: NORMAL)) ===============
INFO:root:          Train period size: 160537
INFO:root:          Test period: 2023-09-26 19:59:00+00:00 to 2023-11-20 16:16:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 3...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 3 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 3.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=3, Wasserstein=0.2073 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=3, T-test p=0.0001 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=3, Wasserstein=1.1380 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 3 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 3. Mean Wasserstein: 0.0686
INFO:root:          Adjusting parameters based on drift for Fold 3...
WARNING:root:          (Drift Override) RSI Drift (1.1380 > 0.30) detected. Ignoring RSI scoring for Fold 3.
INFO:root:          Starting Capital Fold 3: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 3 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_BUY_NORMAL (BUY), Fold: 3, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_BUY_NORMAL (53512 bars)...
  Sim (Fold2_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_BUY_NORMAL at index 2023-09-26 20:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_BUY_NORMAL.
INFO:root:Created trade log DataFrame for Fold2_BUY_NORMAL with 0 entries.
INFO:root:  (Finished) Fold2_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 3 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_SELL_NORMAL (SELL), Fold: 3, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_SELL_NORMAL (53512 bars)...
  Sim (Fold2_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:04:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_SELL_NORMAL at index 2023-09-26 20:04:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_SELL_NORMAL.
INFO:root:Created trade log DataFrame for Fold2_SELL_NORMAL with 0 entries.
INFO:root:  (Finished) Fold2_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 3 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Buy (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Buy (NORMAL)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Sell (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Sell (NORMAL)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 3 (NORMAL): No trades opened. All entries blocked.
WARNING:root:=============== Fold 3/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 3 processed in: 7.40 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 4/5 ((Final Run - Fund: NORMAL)) ===============
INFO:root:          Train period size: 214049
INFO:root:          Test period: 2023-11-20 16:17:00+00:00 to 2024-01-16 21:35:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 4...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 4 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 4.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=4, Wasserstein=0.1807 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=4, T-test p=0.0015 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=4, T-test p=0.0018 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=4, T-test p=0.0009 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=4, Wasserstein=1.3158 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 4 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 4. Mean Wasserstein: 0.0935
INFO:root:          Adjusting parameters based on drift for Fold 4...
WARNING:root:          (Drift Override) RSI Drift (1.3158 > 0.30) detected. Ignoring RSI scoring for Fold 4.
INFO:root:          Starting Capital Fold 4: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 4 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_BUY_NORMAL (BUY), Fold: 4, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_BUY_NORMAL (53512 bars)...
  Sim (Fold3_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:19:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_BUY_NORMAL at index 2023-11-20 16:19:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_BUY_NORMAL.
INFO:root:Created trade log DataFrame for Fold3_BUY_NORMAL with 0 entries.
INFO:root:  (Finished) Fold3_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 4 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_SELL_NORMAL (SELL), Fold: 4, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_SELL_NORMAL (53512 bars)...
  Sim (Fold3_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 1.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.70
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 916, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 08:33:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_SELL_NORMAL at index 2023-11-21 08:33:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_SELL_NORMAL.
INFO:root:Created trade log DataFrame for Fold3_SELL_NORMAL with 0 entries.
INFO:root:  (Finished) Fold3_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 4 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Buy (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Buy (NORMAL)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Sell (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Sell (NORMAL)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 4 (NORMAL): No trades opened. All entries blocked.
WARNING:root:=============== Fold 4/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 4 processed in: 11.13 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 5/5 ((Final Run - Fund: NORMAL)) ===============
INFO:root:          Train period size: 267561
INFO:root:          Test period: 2024-01-16 21:36:00+00:00 to 2024-03-11 18:21:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 5...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 5 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 5.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=5, Wasserstein=0.7486 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=5, Wasserstein=2.0210 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=5, T-test p=0.0236 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 5 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 5. Mean Wasserstein: 0.1159
INFO:root:          Adjusting parameters based on drift for Fold 5...
WARNING:root:          (Drift Override) RSI Drift (2.0210 > 0.30) detected. Ignoring RSI scoring for Fold 5.
INFO:root:          Starting Capital Fold 5: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 5 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_BUY_NORMAL (BUY), Fold: 5, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_BUY_NORMAL (53512 bars)...
  Sim (Fold4_BUY_NORMAL, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:44:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_BUY_NORMAL at index 2024-01-16 21:44:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_BUY_NORMAL.
INFO:root:Created trade log DataFrame for Fold4_BUY_NORMAL with 0 entries.
INFO:root:  (Finished) Fold4_BUY_NORMAL (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 5 (NORMAL) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_SELL_NORMAL (SELL), Fold: 5, Capital:$100.00, MM Mode:'balanced'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_SELL_NORMAL (53512 bars)...
  Sim (Fold4_SELL_NORMAL, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2024-01-16 21:41:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_SELL_NORMAL at index 2024-01-16 21:41:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_SELL_NORMAL.
INFO:root:Created trade log DataFrame for Fold4_SELL_NORMAL with 0 entries.
INFO:root:  (Finished) Fold4_SELL_NORMAL (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 5 (NORMAL) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Buy (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Buy (NORMAL)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Sell (NORMAL)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Sell (NORMAL)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 5 (NORMAL): No trades opened. All entries blocked.
WARNING:root:=============== Fold 5/5 (NORMAL) ===============
WARNING:root:   (Metrics) Fold 5 processed in: 7.72 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:      [Runner (Final Run - Fund: NORMAL)] (Success) Full WF Sim completed (L1_Th=0.50) in 40.86 seconds.
ERROR:root:      [Runner (Final Run - Fund: NORMAL)] (Error) No trades were logged in any fold (L1_Th=0.50). Cannot aggregate results.
INFO:root:
(Aggregating) กำลังรวมผลลัพธ์ Final Walk-Forward Run (Fund: NORMAL)...
ERROR:root:(Error) Final Walk-Forward Run (Fund: NORMAL) ล้มเหลว หรือไม่ได้สร้าง Metrics.
INFO:root:
==================== STARTING FUND: SPIKE (MM Mode: spike_only) ====================
INFO:root:--- FINAL WALK-FORWARD RUN (Fund: SPIKE, Suffix: _SPIKE_fixed_params_switcher_on) ---
INFO:root:      [Runner (Final Run - Fund: SPIKE)] เริ่มต้น Full WF Sim (L1_Th=0.50)
INFO:root:      Initializing TimeSeriesSplit with n_splits=5
INFO:root:      Starting Walk-Forward loop (5 folds)...
Running folds:   0%|          | 0/5 [00:00<?, ?fold/s]
INFO:root:
=============== Fold 1/5 ((Final Run - Fund: SPIKE)) ===============
INFO:root:          Train period size: 53513
INFO:root:          Test period: 2023-06-08 18:35:00+00:00 to 2023-08-02 19:13:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 1...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 1 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 1.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=1, Wasserstein=0.5939 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=1, Wasserstein=0.6332 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=1, T-test p=0.0280 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 1 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 1. Mean Wasserstein: 0.0874
INFO:root:          Adjusting parameters based on drift for Fold 1...
WARNING:root:          (Drift Override) RSI Drift (0.6332 > 0.30) detected. Ignoring RSI scoring for Fold 1.
INFO:root:          Starting Capital Fold 1: BUY=$100.00, SELL=$100.00 (Initial)
INFO:root:   -- Running BUY Simulation Fold 1 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_BUY_SPIKE (BUY), Fold: 1, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_BUY_SPIKE (53512 bars)...
  Sim (Fold0_BUY_SPIKE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:36:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_BUY_SPIKE at index 2023-06-08 18:36:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_BUY_SPIKE.
INFO:root:Created trade log DataFrame for Fold0_BUY_SPIKE with 0 entries.
INFO:root:  (Finished) Fold0_BUY_SPIKE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 1 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_SELL_SPIKE (SELL), Fold: 1, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_SELL_SPIKE (53512 bars)...
  Sim (Fold0_SELL_SPIKE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 268, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-06-09 00:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_SELL_SPIKE at index 2023-06-09 00:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_SELL_SPIKE.
INFO:root:Created trade log DataFrame for Fold0_SELL_SPIKE with 0 entries.
INFO:root:  (Finished) Fold0_SELL_SPIKE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 1 (SPIKE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Buy (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Buy (SPIKE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Sell (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Sell (SPIKE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 1 (SPIKE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 1/5 (SPIKE) ===============
WARNING:root:   (Metrics) Fold 1 processed in: 7.48 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 2/5 ((Final Run - Fund: SPIKE)) ===============
INFO:root:          Train period size: 107025
INFO:root:          Test period: 2023-08-02 19:14:00+00:00 to 2023-09-26 19:58:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 2...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 2 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 2.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=2, Wasserstein=0.2364 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='ATR_14', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, Wasserstein=0.1495 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, Wasserstein=0.1504 > 0.10
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=2, Wasserstein=0.1014 > 0.10
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=2, Wasserstein=0.7809 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 2 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=2
INFO:root:          Drift Analysis complete for Fold 2. Mean Wasserstein: 0.0994
INFO:root:          Adjusting parameters based on drift for Fold 2...
WARNING:root:          (Drift Override) RSI Drift (0.7809 > 0.30) detected. Ignoring RSI scoring for Fold 2.
INFO:root:          Starting Capital Fold 2: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 2 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_BUY_SPIKE (BUY), Fold: 2, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_BUY_SPIKE (53512 bars)...
  Sim (Fold1_BUY_SPIKE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:27:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_BUY_SPIKE at index 2023-08-02 19:27:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_BUY_SPIKE.
INFO:root:Created trade log DataFrame for Fold1_BUY_SPIKE with 0 entries.
INFO:root:  (Finished) Fold1_BUY_SPIKE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 2 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_SELL_SPIKE (SELL), Fold: 2, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_SELL_SPIKE (53512 bars)...
  Sim (Fold1_SELL_SPIKE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:24:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_SELL_SPIKE at index 2023-08-02 19:24:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_SELL_SPIKE.
INFO:root:Created trade log DataFrame for Fold1_SELL_SPIKE with 0 entries.
INFO:root:  (Finished) Fold1_SELL_SPIKE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 2 (SPIKE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Buy (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Buy (SPIKE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Sell (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Sell (SPIKE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 2 (SPIKE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 2/5 (SPIKE) ===============
WARNING:root:   (Metrics) Fold 2 processed in: 6.64 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 3/5 ((Final Run - Fund: SPIKE)) ===============
INFO:root:          Train period size: 160537
INFO:root:          Test period: 2023-09-26 19:59:00+00:00 to 2023-11-20 16:16:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 3...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 3 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 3.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=3, Wasserstein=0.2073 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=3, T-test p=0.0001 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=3, Wasserstein=1.1380 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 3 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 3. Mean Wasserstein: 0.0686
INFO:root:          Adjusting parameters based on drift for Fold 3...
WARNING:root:          (Drift Override) RSI Drift (1.1380 > 0.30) detected. Ignoring RSI scoring for Fold 3.
INFO:root:          Starting Capital Fold 3: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 3 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_BUY_SPIKE (BUY), Fold: 3, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_BUY_SPIKE (53512 bars)...
  Sim (Fold2_BUY_SPIKE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_BUY_SPIKE at index 2023-09-26 20:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_BUY_SPIKE.
INFO:root:Created trade log DataFrame for Fold2_BUY_SPIKE with 0 entries.
INFO:root:  (Finished) Fold2_BUY_SPIKE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 3 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_SELL_SPIKE (SELL), Fold: 3, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_SELL_SPIKE (53512 bars)...
  Sim (Fold2_SELL_SPIKE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:04:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_SELL_SPIKE at index 2023-09-26 20:04:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_SELL_SPIKE.
INFO:root:Created trade log DataFrame for Fold2_SELL_SPIKE with 0 entries.
INFO:root:  (Finished) Fold2_SELL_SPIKE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 3 (SPIKE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Buy (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Buy (SPIKE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Sell (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Sell (SPIKE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 3 (SPIKE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 3/5 (SPIKE) ===============
WARNING:root:   (Metrics) Fold 3 processed in: 7.28 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 4/5 ((Final Run - Fund: SPIKE)) ===============
INFO:root:          Train period size: 214049
INFO:root:          Test period: 2023-11-20 16:17:00+00:00 to 2024-01-16 21:35:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 4...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 4 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 4.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=4, Wasserstein=0.1807 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=4, T-test p=0.0015 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=4, T-test p=0.0018 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=4, T-test p=0.0009 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=4, Wasserstein=1.3158 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 4 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 4. Mean Wasserstein: 0.0935
INFO:root:          Adjusting parameters based on drift for Fold 4...
WARNING:root:          (Drift Override) RSI Drift (1.3158 > 0.30) detected. Ignoring RSI scoring for Fold 4.
INFO:root:          Starting Capital Fold 4: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 4 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_BUY_SPIKE (BUY), Fold: 4, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_BUY_SPIKE (53512 bars)...
  Sim (Fold3_BUY_SPIKE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:19:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_BUY_SPIKE at index 2023-11-20 16:19:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_BUY_SPIKE.
INFO:root:Created trade log DataFrame for Fold3_BUY_SPIKE with 0 entries.
INFO:root:  (Finished) Fold3_BUY_SPIKE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 4 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_SELL_SPIKE (SELL), Fold: 4, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_SELL_SPIKE (53512 bars)...
  Sim (Fold3_SELL_SPIKE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 1.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.70
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 916, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 08:33:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_SELL_SPIKE at index 2023-11-21 08:33:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_SELL_SPIKE.
INFO:root:Created trade log DataFrame for Fold3_SELL_SPIKE with 0 entries.
INFO:root:  (Finished) Fold3_SELL_SPIKE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 4 (SPIKE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Buy (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Buy (SPIKE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Sell (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Sell (SPIKE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 4 (SPIKE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 4/5 (SPIKE) ===============
WARNING:root:   (Metrics) Fold 4 processed in: 10.71 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 5/5 ((Final Run - Fund: SPIKE)) ===============
INFO:root:          Train period size: 267561
INFO:root:          Test period: 2024-01-16 21:36:00+00:00 to 2024-03-11 18:21:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 5...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 5 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 5.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=5, Wasserstein=0.7486 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=5, Wasserstein=2.0210 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=5, T-test p=0.0236 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 5 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 5. Mean Wasserstein: 0.1159
INFO:root:          Adjusting parameters based on drift for Fold 5...
WARNING:root:          (Drift Override) RSI Drift (2.0210 > 0.30) detected. Ignoring RSI scoring for Fold 5.
INFO:root:          Starting Capital Fold 5: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 5 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_BUY_SPIKE (BUY), Fold: 5, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_BUY_SPIKE (53512 bars)...
  Sim (Fold4_BUY_SPIKE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:44:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_BUY_SPIKE at index 2024-01-16 21:44:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_BUY_SPIKE.
INFO:root:Created trade log DataFrame for Fold4_BUY_SPIKE with 0 entries.
INFO:root:  (Finished) Fold4_BUY_SPIKE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 5 (SPIKE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_SELL_SPIKE (SELL), Fold: 5, Capital:$100.00, MM Mode:'spike_only'(Risk:0.020), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_SELL_SPIKE (53512 bars)...
  Sim (Fold4_SELL_SPIKE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2024-01-16 21:41:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_SELL_SPIKE at index 2024-01-16 21:41:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_SELL_SPIKE.
INFO:root:Created trade log DataFrame for Fold4_SELL_SPIKE with 0 entries.
INFO:root:  (Finished) Fold4_SELL_SPIKE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 5 (SPIKE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Buy (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Buy (SPIKE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Sell (SPIKE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Sell (SPIKE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 5 (SPIKE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 5/5 (SPIKE) ===============
WARNING:root:   (Metrics) Fold 5 processed in: 7.12 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:      [Runner (Final Run - Fund: SPIKE)] (Success) Full WF Sim completed (L1_Th=0.50) in 40.16 seconds.
ERROR:root:      [Runner (Final Run - Fund: SPIKE)] (Error) No trades were logged in any fold (L1_Th=0.50). Cannot aggregate results.
INFO:root:
(Aggregating) กำลังรวมผลลัพธ์ Final Walk-Forward Run (Fund: SPIKE)...
ERROR:root:(Error) Final Walk-Forward Run (Fund: SPIKE) ล้มเหลว หรือไม่ได้สร้าง Metrics.
INFO:root:
==================== STARTING FUND: AGGRESSIVE (MM Mode: high_freq) ====================
INFO:root:--- FINAL WALK-FORWARD RUN (Fund: AGGRESSIVE, Suffix: _AGGRESSIVE_fixed_params_switcher_on) ---
INFO:root:      [Runner (Final Run - Fund: AGGRESSIVE)] เริ่มต้น Full WF Sim (L1_Th=0.50)
INFO:root:      Initializing TimeSeriesSplit with n_splits=5
INFO:root:      Starting Walk-Forward loop (5 folds)...
Running folds:   0%|          | 0/5 [00:00<?, ?fold/s]
INFO:root:
=============== Fold 1/5 ((Final Run - Fund: AGGRESSIVE)) ===============
INFO:root:          Train period size: 53513
INFO:root:          Test period: 2023-06-08 18:35:00+00:00 to 2023-08-02 19:13:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 1...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 1 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 1.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=1, Wasserstein=0.5939 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=1, Wasserstein=0.6332 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=1, T-test p=0.0280 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 1 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 1. Mean Wasserstein: 0.0874
INFO:root:          Adjusting parameters based on drift for Fold 1...
WARNING:root:          (Drift Override) RSI Drift (0.6332 > 0.30) detected. Ignoring RSI scoring for Fold 1.
INFO:root:          Starting Capital Fold 1: BUY=$100.00, SELL=$100.00 (Initial)
INFO:root:   -- Running BUY Simulation Fold 1 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_BUY_AGGRESSIVE (BUY), Fold: 1, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_BUY_AGGRESSIVE (53512 bars)...
  Sim (Fold0_BUY_AGGRESSIVE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:36:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_BUY_AGGRESSIVE at index 2023-06-08 18:36:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_BUY_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold0_BUY_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold0_BUY_AGGRESSIVE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 1 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_SELL_AGGRESSIVE (SELL), Fold: 1, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_SELL_AGGRESSIVE (53512 bars)...
  Sim (Fold0_SELL_AGGRESSIVE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 268, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-06-09 00:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_SELL_AGGRESSIVE at index 2023-06-09 00:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_SELL_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold0_SELL_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold0_SELL_AGGRESSIVE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 1 (AGGRESSIVE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Buy (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Buy (AGGRESSIVE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Sell (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Sell (AGGRESSIVE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 1 (AGGRESSIVE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 1/5 (AGGRESSIVE) ===============
WARNING:root:   (Metrics) Fold 1 processed in: 7.01 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 2/5 ((Final Run - Fund: AGGRESSIVE)) ===============
INFO:root:          Train period size: 107025
INFO:root:          Test period: 2023-08-02 19:14:00+00:00 to 2023-09-26 19:58:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 2...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 2 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 2.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=2, Wasserstein=0.2364 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='ATR_14', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, Wasserstein=0.1495 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, Wasserstein=0.1504 > 0.10
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=2, Wasserstein=0.1014 > 0.10
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=2, Wasserstein=0.7809 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 2 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=2
INFO:root:          Drift Analysis complete for Fold 2. Mean Wasserstein: 0.0994
INFO:root:          Adjusting parameters based on drift for Fold 2...
WARNING:root:          (Drift Override) RSI Drift (0.7809 > 0.30) detected. Ignoring RSI scoring for Fold 2.
INFO:root:          Starting Capital Fold 2: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 2 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_BUY_AGGRESSIVE (BUY), Fold: 2, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_BUY_AGGRESSIVE (53512 bars)...
  Sim (Fold1_BUY_AGGRESSIVE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:27:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_BUY_AGGRESSIVE at index 2023-08-02 19:27:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_BUY_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold1_BUY_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold1_BUY_AGGRESSIVE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 2 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_SELL_AGGRESSIVE (SELL), Fold: 2, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_SELL_AGGRESSIVE (53512 bars)...
  Sim (Fold1_SELL_AGGRESSIVE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:24:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_SELL_AGGRESSIVE at index 2023-08-02 19:24:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_SELL_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold1_SELL_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold1_SELL_AGGRESSIVE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 2 (AGGRESSIVE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Buy (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Buy (AGGRESSIVE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Sell (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Sell (AGGRESSIVE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 2 (AGGRESSIVE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 2/5 (AGGRESSIVE) ===============
WARNING:root:   (Metrics) Fold 2 processed in: 5.80 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 3/5 ((Final Run - Fund: AGGRESSIVE)) ===============
INFO:root:          Train period size: 160537
INFO:root:          Test period: 2023-09-26 19:59:00+00:00 to 2023-11-20 16:16:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 3...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 3 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 3.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=3, Wasserstein=0.2073 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=3, T-test p=0.0001 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=3, Wasserstein=1.1380 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 3 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 3. Mean Wasserstein: 0.0686
INFO:root:          Adjusting parameters based on drift for Fold 3...
WARNING:root:          (Drift Override) RSI Drift (1.1380 > 0.30) detected. Ignoring RSI scoring for Fold 3.
INFO:root:          Starting Capital Fold 3: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 3 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_BUY_AGGRESSIVE (BUY), Fold: 3, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_BUY_AGGRESSIVE (53512 bars)...
  Sim (Fold2_BUY_AGGRESSIVE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_BUY_AGGRESSIVE at index 2023-09-26 20:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_BUY_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold2_BUY_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold2_BUY_AGGRESSIVE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 3 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_SELL_AGGRESSIVE (SELL), Fold: 3, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_SELL_AGGRESSIVE (53512 bars)...
  Sim (Fold2_SELL_AGGRESSIVE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:04:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_SELL_AGGRESSIVE at index 2023-09-26 20:04:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_SELL_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold2_SELL_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold2_SELL_AGGRESSIVE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 3 (AGGRESSIVE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Buy (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Buy (AGGRESSIVE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Sell (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Sell (AGGRESSIVE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 3 (AGGRESSIVE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 3/5 (AGGRESSIVE) ===============
WARNING:root:   (Metrics) Fold 3 processed in: 7.09 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 4/5 ((Final Run - Fund: AGGRESSIVE)) ===============
INFO:root:          Train period size: 214049
INFO:root:          Test period: 2023-11-20 16:17:00+00:00 to 2024-01-16 21:35:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 4...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 4 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 4.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=4, Wasserstein=0.1807 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=4, T-test p=0.0015 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=4, T-test p=0.0018 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=4, T-test p=0.0009 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=4, Wasserstein=1.3158 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 4 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 4. Mean Wasserstein: 0.0935
INFO:root:          Adjusting parameters based on drift for Fold 4...
WARNING:root:          (Drift Override) RSI Drift (1.3158 > 0.30) detected. Ignoring RSI scoring for Fold 4.
INFO:root:          Starting Capital Fold 4: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 4 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_BUY_AGGRESSIVE (BUY), Fold: 4, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_BUY_AGGRESSIVE (53512 bars)...
  Sim (Fold3_BUY_AGGRESSIVE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:19:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_BUY_AGGRESSIVE at index 2023-11-20 16:19:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_BUY_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold3_BUY_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold3_BUY_AGGRESSIVE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 4 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_SELL_AGGRESSIVE (SELL), Fold: 4, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_SELL_AGGRESSIVE (53512 bars)...
  Sim (Fold3_SELL_AGGRESSIVE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 1.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.70
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 916, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 08:33:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_SELL_AGGRESSIVE at index 2023-11-21 08:33:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_SELL_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold3_SELL_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold3_SELL_AGGRESSIVE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 4 (AGGRESSIVE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Buy (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Buy (AGGRESSIVE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Sell (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Sell (AGGRESSIVE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 4 (AGGRESSIVE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 4/5 (AGGRESSIVE) ===============
WARNING:root:   (Metrics) Fold 4 processed in: 10.83 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 5/5 ((Final Run - Fund: AGGRESSIVE)) ===============
INFO:root:          Train period size: 267561
INFO:root:          Test period: 2024-01-16 21:36:00+00:00 to 2024-03-11 18:21:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 5...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 5 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 5.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=5, Wasserstein=0.7486 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=5, Wasserstein=2.0210 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=5, T-test p=0.0236 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 5 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 5. Mean Wasserstein: 0.1159
INFO:root:          Adjusting parameters based on drift for Fold 5...
WARNING:root:          (Drift Override) RSI Drift (2.0210 > 0.30) detected. Ignoring RSI scoring for Fold 5.
INFO:root:          Starting Capital Fold 5: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 5 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_BUY_AGGRESSIVE (BUY), Fold: 5, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_BUY_AGGRESSIVE (53512 bars)...
  Sim (Fold4_BUY_AGGRESSIVE, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:44:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_BUY_AGGRESSIVE at index 2024-01-16 21:44:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_BUY_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold4_BUY_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold4_BUY_AGGRESSIVE (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 5 (AGGRESSIVE) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_SELL_AGGRESSIVE (SELL), Fold: 5, Capital:$100.00, MM Mode:'high_freq'(Risk:0.030), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_SELL_AGGRESSIVE (53512 bars)...
  Sim (Fold4_SELL_AGGRESSIVE, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2024-01-16 21:41:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_SELL_AGGRESSIVE at index 2024-01-16 21:41:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_SELL_AGGRESSIVE.
INFO:root:Created trade log DataFrame for Fold4_SELL_AGGRESSIVE with 0 entries.
INFO:root:  (Finished) Fold4_SELL_AGGRESSIVE (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 5 (AGGRESSIVE) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Buy (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Buy (AGGRESSIVE)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Sell (AGGRESSIVE)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Sell (AGGRESSIVE)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 5 (AGGRESSIVE): No trades opened. All entries blocked.
WARNING:root:=============== Fold 5/5 (AGGRESSIVE) ===============
WARNING:root:   (Metrics) Fold 5 processed in: 7.43 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:      [Runner (Final Run - Fund: AGGRESSIVE)] (Success) Full WF Sim completed (L1_Th=0.50) in 39.05 seconds.
ERROR:root:      [Runner (Final Run - Fund: AGGRESSIVE)] (Error) No trades were logged in any fold (L1_Th=0.50). Cannot aggregate results.
INFO:root:
(Aggregating) กำลังรวมผลลัพธ์ Final Walk-Forward Run (Fund: AGGRESSIVE)...
ERROR:root:(Error) Final Walk-Forward Run (Fund: AGGRESSIVE) ล้มเหลว หรือไม่ได้สร้าง Metrics.
INFO:root:
==================== STARTING FUND: MIRROR (MM Mode: mirror) ====================
INFO:root:--- FINAL WALK-FORWARD RUN (Fund: MIRROR, Suffix: _MIRROR_fixed_params_switcher_on) ---
INFO:root:      [Runner (Final Run - Fund: MIRROR)] เริ่มต้น Full WF Sim (L1_Th=0.50)
INFO:root:      Initializing TimeSeriesSplit with n_splits=5
INFO:root:      Starting Walk-Forward loop (5 folds)...
Running folds:   0%|          | 0/5 [00:00<?, ?fold/s]
INFO:root:
=============== Fold 1/5 ((Final Run - Fund: MIRROR)) ===============
INFO:root:          Train period size: 53513
INFO:root:          Test period: 2023-06-08 18:35:00+00:00 to 2023-08-02 19:13:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 1...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 1 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 1.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=1, Wasserstein=0.5939 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=1, Wasserstein=0.6332 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=1, T-test p=0.0280 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=1, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 1 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 1. Mean Wasserstein: 0.0874
INFO:root:          Adjusting parameters based on drift for Fold 1...
WARNING:root:          (Drift Override) RSI Drift (0.6332 > 0.30) detected. Ignoring RSI scoring for Fold 1.
INFO:root:          Starting Capital Fold 1: BUY=$100.00, SELL=$100.00 (Initial)
INFO:root:   -- Running BUY Simulation Fold 1 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_BUY_MIRROR (BUY), Fold: 1, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_BUY_MIRROR (53512 bars)...
  Sim (Fold0_BUY_MIRROR, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-06-08 18:36:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_BUY_MIRROR at index 2023-06-08 18:36:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_BUY_MIRROR.
INFO:root:Created trade log DataFrame for Fold0_BUY_MIRROR with 0 entries.
INFO:root:  (Finished) Fold0_BUY_MIRROR (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 1 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 1 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold0_SELL_MIRROR (SELL), Fold: 1, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold0_SELL_MIRROR (53512 bars)...
  Sim (Fold0_SELL_MIRROR, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 268, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-06-09 00:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold0_SELL_MIRROR at index 2023-06-09 00:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold0_SELL_MIRROR.
INFO:root:Created trade log DataFrame for Fold0_SELL_MIRROR with 0 entries.
INFO:root:  (Finished) Fold0_SELL_MIRROR (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 1 (MIRROR) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Buy (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Buy (MIRROR)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 1 Sell (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 1 Sell (MIRROR)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 1 (MIRROR): No trades opened. All entries blocked.
WARNING:root:=============== Fold 1/5 (MIRROR) ===============
WARNING:root:   (Metrics) Fold 1 processed in: 7.02 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 2/5 ((Final Run - Fund: MIRROR)) ===============
INFO:root:          Train period size: 107025
INFO:root:          Test period: 2023-08-02 19:14:00+00:00 to 2023-09-26 19:58:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 2...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 2 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 2.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=2, Wasserstein=0.2364 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='ATR_14', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, Wasserstein=0.1495 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, Wasserstein=0.1496 > 0.10
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, Wasserstein=0.1504 > 0.10
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=2, Wasserstein=0.1014 > 0.10
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=2, Wasserstein=0.7809 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=2, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 2 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=2
INFO:root:          Drift Analysis complete for Fold 2. Mean Wasserstein: 0.0994
INFO:root:          Adjusting parameters based on drift for Fold 2...
WARNING:root:          (Drift Override) RSI Drift (0.7809 > 0.30) detected. Ignoring RSI scoring for Fold 2.
INFO:root:          Starting Capital Fold 2: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 2 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_BUY_MIRROR (BUY), Fold: 2, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_BUY_MIRROR (53512 bars)...
  Sim (Fold1_BUY_MIRROR, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-08-02 19:27:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_BUY_MIRROR at index 2023-08-02 19:27:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_BUY_MIRROR.
INFO:root:Created trade log DataFrame for Fold1_BUY_MIRROR with 0 entries.
INFO:root:  (Finished) Fold1_BUY_MIRROR (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 2 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 2 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold1_SELL_MIRROR (SELL), Fold: 2, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold1_SELL_MIRROR (53512 bars)...
  Sim (Fold1_SELL_MIRROR, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 0.90
INFO:root:[Adaptive] Current Signal_Score threshold: 0.60
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-08-02 19:24:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold1_SELL_MIRROR at index 2023-08-02 19:24:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold1_SELL_MIRROR.
INFO:root:Created trade log DataFrame for Fold1_SELL_MIRROR with 0 entries.
INFO:root:  (Finished) Fold1_SELL_MIRROR (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 2 (MIRROR) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Buy (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Buy (MIRROR)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 2 Sell (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 2 Sell (MIRROR)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 2 (MIRROR): No trades opened. All entries blocked.
WARNING:root:=============== Fold 2/5 (MIRROR) ===============
WARNING:root:   (Metrics) Fold 2 processed in: 5.87 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 3/5 ((Final Run - Fund: MIRROR)) ===============
INFO:root:          Train period size: 160537
INFO:root:          Test period: 2023-09-26 19:59:00+00:00 to 2023-11-20 16:16:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 3...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 3 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 3.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=3, Wasserstein=0.2073 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=3, T-test p=0.0001 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=3, Wasserstein=1.1380 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=3, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 3 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 3. Mean Wasserstein: 0.0686
INFO:root:          Adjusting parameters based on drift for Fold 3...
WARNING:root:          (Drift Override) RSI Drift (1.1380 > 0.30) detected. Ignoring RSI scoring for Fold 3.
INFO:root:          Starting Capital Fold 3: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 3 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_BUY_MIRROR (BUY), Fold: 3, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_BUY_MIRROR (53512 bars)...
  Sim (Fold2_BUY_MIRROR, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-09-26 20:03:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_BUY_MIRROR at index 2023-09-26 20:03:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_BUY_MIRROR.
INFO:root:Created trade log DataFrame for Fold2_BUY_MIRROR with 0 entries.
INFO:root:  (Finished) Fold2_BUY_MIRROR (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 3 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 3 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold2_SELL_MIRROR (SELL), Fold: 3, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold2_SELL_MIRROR (53512 bars)...
  Sim (Fold2_SELL_MIRROR, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2023-09-26 20:04:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold2_SELL_MIRROR at index 2023-09-26 20:04:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold2_SELL_MIRROR.
INFO:root:Created trade log DataFrame for Fold2_SELL_MIRROR with 0 entries.
INFO:root:  (Finished) Fold2_SELL_MIRROR (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 3 (MIRROR) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Buy (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Buy (MIRROR)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 3 Sell (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 3 Sell (MIRROR)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 3 (MIRROR): No trades opened. All entries blocked.
WARNING:root:=============== Fold 3/5 (MIRROR) ===============
WARNING:root:   (Metrics) Fold 3 processed in: 7.13 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 4/5 ((Final Run - Fund: MIRROR)) ===============
INFO:root:          Train period size: 214049
INFO:root:          Test period: 2023-11-20 16:17:00+00:00 to 2024-01-16 21:35:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 4...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 4 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 4.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=4, Wasserstein=0.1807 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=4, T-test p=0.0015 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=4, T-test p=0.0018 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=4, T-test p=0.0009 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=4, Wasserstein=1.3158 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Ratio', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='spike_score', Fold=4, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 4 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 4. Mean Wasserstein: 0.0935
INFO:root:          Adjusting parameters based on drift for Fold 4...
WARNING:root:          (Drift Override) RSI Drift (1.3158 > 0.30) detected. Ignoring RSI scoring for Fold 4.
INFO:root:          Starting Capital Fold 4: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 4 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_BUY_MIRROR (BUY), Fold: 4, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_BUY_MIRROR (53512 bars)...
  Sim (Fold3_BUY_MIRROR, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2023-11-20 16:19:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_BUY_MIRROR at index 2023-11-20 16:19:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_BUY_MIRROR.
INFO:root:Created trade log DataFrame for Fold3_BUY_MIRROR with 0 entries.
INFO:root:  (Finished) Fold3_BUY_MIRROR (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 4 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 4 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold3_SELL_MIRROR (SELL), Fold: 4, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold3_SELL_MIRROR (53512 bars)...
  Sim (Fold3_SELL_MIRROR, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:[Adaptive] Current Signal_Score threshold: 1.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 1.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 2.30
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.70
INFO:root:[Adaptive] Current Signal_Score threshold: 2.40
INFO:root:[Adaptive] Current Signal_Score threshold: 2.10
INFO:root:[Adaptive] Current Signal_Score threshold: 2.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.20
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 2.60
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.80
INFO:root:[Adaptive] Current Signal_Score threshold: 2.50
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:[Adaptive] Current Signal_Score threshold: 2.90
INFO:root:[Adaptive] Current Signal_Score threshold: 3.00
INFO:root:      (Forced Entry Triggered) Side: SELL, Bars since last: 916, Score: -2.00
INFO:root:   Attempting to Open New Order (Forced) for SELL at 2023-11-21 08:33:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold3_SELL_MIRROR at index 2023-11-21 08:33:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold3_SELL_MIRROR.
INFO:root:Created trade log DataFrame for Fold3_SELL_MIRROR with 0 entries.
INFO:root:  (Finished) Fold3_SELL_MIRROR (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 4 (MIRROR) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Buy (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Buy (MIRROR)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 4 Sell (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 4 Sell (MIRROR)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 4 (MIRROR): No trades opened. All entries blocked.
WARNING:root:=============== Fold 4/5 (MIRROR) ===============
WARNING:root:   (Metrics) Fold 4 processed in: 11.11 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:
=============== Fold 5/5 ((Final Run - Fund: MIRROR)) ===============
INFO:root:          Train period size: 267561
INFO:root:          Test period: 2024-01-16 21:36:00+00:00 to 2024-03-11 18:21:00+00:00 (Size: 53512)
INFO:root:          Performing Drift Analysis for Fold 5...
INFO:root:    (DriftObserver) Analyzing Drift for Fold 5 (M1 Features)...
INFO:root:      Analyzing 28 common observed features for Fold 5.
WARNING:root:          (Drift Warning) Feature='ADX', Fold=5, Wasserstein=0.7486 > 0.15
INFO:root:          (Drift Info) Feature='ADX', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Rolling_Avg', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='ATR_14_Shifted', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Body', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Candle_Range', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_line', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='MACD_signal', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
WARNING:root:          [DRIFT ALERT] Feature='RSI', Fold=5, Wasserstein=2.0210 > 0.10
INFO:root:          (Drift Info) Feature='RSI', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='Wick_Length', Fold=5, T-test p=0.0000 < 0.05 (Statistically significant mean difference)
INFO:root:          (Drift Info) Feature='cluster', Fold=5, T-test p=0.0236 < 0.05 (Statistically significant mean difference)
INFO:root:    (DriftObserver) Fold 5 Summary: Analyzed=26, Skipped(NN/Insuf)=2/0, Errors=0, Drift Alerts=1
INFO:root:          Drift Analysis complete for Fold 5. Mean Wasserstein: 0.1159
INFO:root:          Adjusting parameters based on drift for Fold 5...
WARNING:root:          (Drift Override) RSI Drift (2.0210 > 0.30) detected. Ignoring RSI scoring for Fold 5.
INFO:root:          Starting Capital Fold 5: BUY=$100.00, SELL=$100.00 (from previous fold)
INFO:root:   -- Running BUY Simulation Fold 5 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_BUY_MIRROR (BUY), Fold: 5, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_BUY_MIRROR (53512 bars)...
  Sim (Fold4_BUY_MIRROR, BUY):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for BUY at 2024-01-16 21:44:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_BUY_MIRROR at index 2024-01-16 21:44:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_BUY_MIRROR.
INFO:root:Created trade log DataFrame for Fold4_BUY_MIRROR with 0 entries.
INFO:root:  (Finished) Fold4_BUY_MIRROR (BUY) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Running SELL Simulation Fold 5 (MIRROR) --
INFO:root:   [Patch B Check] Using SL Multiplier: 2.8 for Fold 5 (from fold_config or base_cfg)
INFO:root:  (Starting) Backtest: Fold4_SELL_MIRROR (SELL), Fold: 5, Capital:$100.00, MM Mode:'mirror'(Risk:0.010), SLx:2.8(ATR), BE@R:1.0(Dyn), TP1@R:1.0, TP2@R:Dynamic(1.8 Base), PartialTP@R:0.8R (50%), TSL@ATR:1.5, Meta:Switcher(T=0.50), ReEntry:ON(Cool:1b, T=0.50), ForcedEntry:ON(Bars:100, Score>=0.50), PartialTP:ON(MoveSL:True), KillSwitch:ON(DD>25%, Losses>7), SpikeGuard:ON, RecoveryMM:ON(Losses>=4, LotMult=0.5), MM Boost: ON, DriftOverride: ACTIVE (RSI_Drift)
INFO:root:Starting simulation loop for Fold4_SELL_MIRROR (53512 bars)...
  Sim (Fold4_SELL_MIRROR, SELL):   0%|          | 0/53512 [00:00<?, ?it/s]
INFO:root:[Adaptive] Current Signal_Score threshold: 0.50
INFO:root:   Attempting to Open New Order (Standard) for SELL at 2024-01-16 21:41:00+00:00...
CRITICAL:root:   (CRITICAL) Error occurred inside simulation loop for Fold4_SELL_MIRROR at index 2024-01-16 21:41:00+00:00: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
Traceback (most recent call last):
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in run_backtest_simulation_v34
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/content/drive/MyDrive/Phiradon168/src/strategy.py", line 2124, in <listcomp>
    missing_ml_features = [f for f in active_l1_features if f not in row.index]
                                                            ^^^^^^^^^^^^^^^^^^
TypeError: argument of type 'builtin_function_or_method' is not iterable
INFO:root:Simulation loop finished for Fold4_SELL_MIRROR.
INFO:root:Created trade log DataFrame for Fold4_SELL_MIRROR with 0 entries.
INFO:root:  (Finished) Fold4_SELL_MIRROR (SELL) เสร็จสมบูรณ์. Trades:0, ReEntries:0, Forced:0, BEs:0, TSLs:0
INFO:root:      Equity สุดท้าย: $100.00 (จาก $100.00)
WARNING:root:[QA][SUMMARY] Fold Finished | Final Equity: $100.00 | Max DD: 0.00% | KILL SWITCH: False
INFO:root:      Blocks: MaxDD=0, Cooldown=0, LotScale=0, ML1Skip=0(T=0.50)
INFO:root:      Blocks (New v4.6/v4.8): Vol/ATR/MACD/SoftCool/Spike=0
INFO:root:   -- Calculating Metrics for Fold 5 (MIRROR) --
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Buy (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Buy (MIRROR)'. Returning default metrics.
INFO:root:  (Metrics) Calculating metrics for: 'Fold 5 Sell (MIRROR)'...
WARNING:root:    (Warning) No trades logged for 'Fold 5 Sell (MIRROR)'. Returning default metrics.
WARNING:root:          [SUMMARY] Fold 5 (MIRROR): No trades opened. All entries blocked.
WARNING:root:=============== Fold 5/5 (MIRROR) ===============
WARNING:root:   (Metrics) Fold 5 processed in: 7.55 seconds
WARNING:root:   (Summary) Equity=100.00, Winrate=0.00%, MaxDD=0.00%
WARNING:root:  [QA SUMMARY FOLD] | Final Equity: $100.00 | Max DD: 0.00% | Winrate: 0.00% | Trades: 0 | KILL SWITCH: False | Recovery: False
INFO:root:      [Runner (Final Run - Fund: MIRROR)] (Success) Full WF Sim completed (L1_Th=0.50) in 39.55 seconds.
ERROR:root:      [Runner (Final Run - Fund: MIRROR)] (Error) No trades were logged in any fold (L1_Th=0.50). Cannot aggregate results.
INFO:root:
(Aggregating) กำลังรวมผลลัพธ์ Final Walk-Forward Run (Fund: MIRROR)...
ERROR:root:(Error) Final Walk-Forward Run (Fund: MIRROR) ล้มเหลว หรือไม่ได้สร้าง Metrics.
INFO:root:
==================== MULTI-FUND RUN COMPLETED ====================
WARNING:root:   (Warning) No trade logs found to combine for ALL_FUNDS summary.
INFO:root:
--- IB Commission Summary (All Funds) ---
INFO:root:   Total Accumulated Lots (All Funds): 0.00
INFO:root:   Estimated Total IB Commission (USD): $0.00
INFO:root:-----------------------------------------
INFO:root:
--- ฟังก์ชัน Main (Mode: FULL_RUN) เสร็จสิ้นใน 243.17 วินาที ---
INFO:root:
(Finished) FULL PIPELINE เสร็จสมบูรณ์.
[2025-06-04 09:09:27,961][INFO][1637][ProjectP.py:42] - [QA] Output present: ./output_default/features_main.json
INFO:NiceGold:[QA] Output present: ./output_default/features_main.json
[2025-06-04 09:09:27,962][ERROR][1637][ProjectP.py:44] - [QA] Output missing: ./output_default/trade_log_BUY.csv
ERROR:NiceGold:[QA] Output missing: ./output_default/trade_log_BUY.csv
[2025-06-04 09:09:27,962][ERROR][1637][ProjectP.py:44] - [QA] Output missing: ./output_default/trade_log_SELL.csv
ERROR:NiceGold:[QA] Output missing: ./output_default/trade_log_SELL.csv
[2025-06-04 09:09:27,962][ERROR][1637][ProjectP.py:44] - [QA] Output missing: ./output_default/trade_log_NORMAL.csv
ERROR:NiceGold:[QA] Output missing: ./output_default/trade_log_NORMAL.csv
INFO:root:GPU resources released
